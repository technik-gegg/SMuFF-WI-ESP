window.innerWidth<768&&[].slice.call(document.querySelectorAll("[data-bss-disabled-mobile]")).forEach((function(e){e.classList.remove("animated"),e.removeAttribute("data-bss-hover-animate"),e.removeAttribute("data-aos")})),document.addEventListener("DOMContentLoaded",(function(){[].slice.call(document.querySelectorAll("[data-bss-tooltip]")).map((function(e){return new bootstrap.Tooltip(e)}));var e=document.querySelectorAll('[data-bs-toggle="toast"]');for(var t of e)t.addEventListener("click",(function(){var e=t.getAttribute("data-bs-target");if(e)try{var o=document.querySelector(e);if(!o)return;new bootstrap.Toast(o).show()}catch(e){console.error(e)}}));var o=document.querySelectorAll("[data-bss-chart]");for(var a of o)a.chart=new Chart(a,JSON.parse(a.dataset.bssChart))}),!1),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Sortable=t()}(this,(function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(){return(t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(e[a]=o[a])}return e}).apply(this,arguments)}function o(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},a=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(o).filter((function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable})))),a.forEach((function(t){var a,n,i;a=e,i=o[n=t],n in a?Object.defineProperty(a,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):a[n]=i}))}return e}function a(e,t){if(null==e)return{};var o,a,n=function(e,t){if(null==e)return{};var o,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)o=i[a],0<=t.indexOf(o)||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)o=i[a],0<=t.indexOf(o)||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function n(e){return function(e){if(Array.isArray(e)){for(var t=0,o=new Array(e.length);t<e.length;t++)o[t]=e[t];return o}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function i(e){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(e)}var r=i(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),s=i(/Edge/i),l=i(/firefox/i),c=i(/safari/i)&&!i(/chrome/i)&&!i(/android/i),d=i(/iP(ad|od|hone)/i),u=i(/chrome/i)&&i(/android/i),p={capture:!1,passive:!1};function h(e,t,o){e.addEventListener(t,o,!r&&p)}function f(e,t,o){e.removeEventListener(t,o,!r&&p)}function m(e,t){if(t){if(">"===t[0]&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch(e){return!1}return!1}}function g(e,t,o,a){if(e){o=o||document;do{if(null!=t&&(">"===t[0]?e.parentNode===o&&m(e,t):m(e,t))||a&&e===o)return e;if(e===o)break}while(e=(n=e).host&&n!==document&&n.host.nodeType?n.host:n.parentNode)}var n;return null}var v,b=/\s+/g;function $(e,t,o){if(e&&t)if(e.classList)e.classList[o?"add":"remove"](t);else{var a=(" "+e.className+" ").replace(b," ").replace(" "+t+" "," ");e.className=(a+(o?" "+t:"")).replace(b," ")}}function w(e,t,o){var a=e&&e.style;if(a){if(void 0===o)return document.defaultView&&document.defaultView.getComputedStyle?o=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(o=e.currentStyle),void 0===t?o:o[t];t in a||-1!==t.indexOf("webkit")||(t="-webkit-"+t),a[t]=o+("string"==typeof o?"":"px")}}function y(e,t){var o="";if("string"==typeof e)o=e;else do{var a=w(e,"transform");a&&"none"!==a&&(o=a+" "+o)}while(!t&&(e=e.parentNode));var n=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return n&&new n(o)}function S(e,t,o){if(e){var a=e.getElementsByTagName(t),n=0,i=a.length;if(o)for(;n<i;n++)o(a[n],n);return a}return[]}function C(){return document.scrollingElement||document.documentElement}function x(e,t,o,a,n){if(e.getBoundingClientRect||e===window){var i,s,l,c,d,u,p;if(p=e!==window&&e.parentNode&&e!==C()?(s=(i=e.getBoundingClientRect()).top,l=i.left,c=i.bottom,d=i.right,u=i.height,i.width):(l=s=0,c=window.innerHeight,d=window.innerWidth,u=window.innerHeight,window.innerWidth),(t||o)&&e!==window&&(n=n||e.parentNode,!r))do{if(n&&n.getBoundingClientRect&&("none"!==w(n,"transform")||o&&"static"!==w(n,"position"))){var h=n.getBoundingClientRect();s-=h.top+parseInt(w(n,"border-top-width")),l-=h.left+parseInt(w(n,"border-left-width")),c=s+i.height,d=l+i.width;break}}while(n=n.parentNode);if(a&&e!==window){var f=y(n||e),m=f&&f.a,g=f&&f.d;f&&(c=(s/=g)+(u/=g),d=(l/=m)+(p/=m))}return{top:s,left:l,bottom:c,right:d,width:p,height:u}}}function D(e,t,o){for(var a=I(e,!0),n=x(e)[t];a;){var i=x(a)[o];if(!("top"===o||"left"===o?i<=n:n<=i))return a;if(a===C())break;a=I(a,!1)}return!1}function k(e,t,o){for(var a=0,n=0,i=e.children;n<i.length;){if("none"!==i[n].style.display&&i[n]!==ze.ghost&&i[n]!==ze.dragged&&g(i[n],o.draggable,e,!1)){if(a===t)return i[n];a++}n++}return null}function T(e,t){for(var o=e.lastElementChild;o&&(o===ze.ghost||"none"===w(o,"display")||t&&!m(o,t));)o=o.previousElementSibling;return o||null}function M(e,t){var o=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)"TEMPLATE"===e.nodeName.toUpperCase()||e===ze.clone||t&&!m(e,t)||o++;return o}function E(e){var t=0,o=0,a=C();if(e)do{var n=y(e),i=n.a,r=n.d;t+=e.scrollLeft*i,o+=e.scrollTop*r}while(e!==a&&(e=e.parentNode));return[t,o]}function I(e,t){if(!e||!e.getBoundingClientRect)return C();var o=e,a=!1;do{if(o.clientWidth<o.scrollWidth||o.clientHeight<o.scrollHeight){var n=w(o);if(o.clientWidth<o.scrollWidth&&("auto"==n.overflowX||"scroll"==n.overflowX)||o.clientHeight<o.scrollHeight&&("auto"==n.overflowY||"scroll"==n.overflowY)){if(!o.getBoundingClientRect||o===document.body)return C();if(a||t)return o;a=!0}}}while(o=o.parentNode);return C()}function F(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}function O(e,t){return function(){if(!v){var o=arguments;1===o.length?e.call(this,o[0]):e.apply(this,o),v=setTimeout((function(){v=void 0}),t)}}}function P(e,t,o){e.scrollLeft+=t,e.scrollTop+=o}function z(e){var t=window.Polymer,o=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):o?o(e).clone(!0)[0]:e.cloneNode(!0)}function _(e,t){w(e,"position","absolute"),w(e,"top",t.top),w(e,"left",t.left),w(e,"width",t.width),w(e,"height",t.height)}function A(e){w(e,"position",""),w(e,"top",""),w(e,"left",""),w(e,"width",""),w(e,"height","")}var W="Sortable"+(new Date).getTime();var N=[],R={initializeByDefault:!0},L={mount:function(e){for(var t in R)!R.hasOwnProperty(t)||t in e||(e[t]=R[t]);N.forEach((function(t){if(t.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")})),N.push(e)},pluginEvent:function(e,t,a){var n=this;this.eventCanceled=!1,a.cancel=function(){n.eventCanceled=!0};var i=e+"Global";N.forEach((function(n){t[n.pluginName]&&(t[n.pluginName][i]&&t[n.pluginName][i](o({sortable:t},a)),t.options[n.pluginName]&&t[n.pluginName][e]&&t[n.pluginName][e](o({sortable:t},a)))}))},initializePlugins:function(e,o,a,n){for(var i in N.forEach((function(n){var i=n.pluginName;if(e.options[i]||n.initializeByDefault){var r=new n(e,o,e.options);r.sortable=e,r.options=e.options,e[i]=r,t(a,r.defaults)}})),e.options)if(e.options.hasOwnProperty(i)){var r=this.modifyOption(e,i,e.options[i]);void 0!==r&&(e.options[i]=r)}},getEventProperties:function(e,o){var a={};return N.forEach((function(n){"function"==typeof n.eventProperties&&t(a,n.eventProperties.call(o[n.pluginName],e))})),a},modifyOption:function(e,t,o){var a;return N.forEach((function(n){e[n.pluginName]&&n.optionListeners&&"function"==typeof n.optionListeners[t]&&(a=n.optionListeners[t].call(e[n.pluginName],o))})),a}};function U(e){var t=e.sortable,a=e.rootEl,n=e.name,i=e.targetEl,l=e.cloneEl,c=e.toEl,d=e.fromEl,u=e.oldIndex,p=e.newIndex,h=e.oldDraggableIndex,f=e.newDraggableIndex,m=e.originalEvent,g=e.putSortable,v=e.extraEventProperties;if(t=t||a&&a[W]){var b,$=t.options,w="on"+n.charAt(0).toUpperCase()+n.substr(1);!window.CustomEvent||r||s?(b=document.createEvent("Event")).initEvent(n,!0,!0):b=new CustomEvent(n,{bubbles:!0,cancelable:!0}),b.to=c||a,b.from=d||a,b.item=i||a,b.clone=l,b.oldIndex=u,b.newIndex=p,b.oldDraggableIndex=h,b.newDraggableIndex=f,b.originalEvent=m,b.pullMode=g?g.lastPutMode:void 0;var y=o({},v,L.getEventProperties(n,t));for(var S in y)b[S]=y[S];a&&a.dispatchEvent(b),$[w]&&$[w].call(t,b)}}function H(e,t,n){var i=2<arguments.length&&void 0!==n?n:{},r=i.evt,s=a(i,["evt"]);L.pluginEvent.bind(ze)(e,t,o({dragEl:G,parentEl:V,ghostEl:X,rootEl:Y,nextEl:q,lastDownEl:Z,cloneEl:j,cloneHidden:J,dragStarted:de,putSortable:ae,activeSortable:ze.active,originalEvent:r,oldIndex:K,oldDraggableIndex:ee,newIndex:Q,newDraggableIndex:te,hideGhostForTarget:Ie,unhideGhostForTarget:Fe,cloneNowHidden:function(){J=!0},cloneNowShown:function(){J=!1},dispatchSortableEvent:function(e){B({sortable:t,name:e,originalEvent:r})}},s))}function B(e){U(o({putSortable:ae,cloneEl:j,targetEl:G,rootEl:Y,oldIndex:K,oldDraggableIndex:ee,newIndex:Q,newDraggableIndex:te},e))}var G,V,X,Y,q,Z,j,J,K,Q,ee,te,oe,ae,ne,ie,re,se,le,ce,de,ue,pe,he,fe,me=!1,ge=!1,ve=[],be=!1,$e=!1,we=[],ye=!1,Se=[],Ce="undefined"!=typeof document,xe=d,De=s||r?"cssFloat":"float",ke=Ce&&!u&&!d&&"draggable"in document.createElement("div"),Te=function(){if(Ce){if(r)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}}(),Me=function(e,t){var o=w(e),a=parseInt(o.width)-parseInt(o.paddingLeft)-parseInt(o.paddingRight)-parseInt(o.borderLeftWidth)-parseInt(o.borderRightWidth),n=k(e,0,t),i=k(e,1,t),r=n&&w(n),s=i&&w(i),l=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+x(n).width,c=s&&parseInt(s.marginLeft)+parseInt(s.marginRight)+x(i).width;if("flex"===o.display)return"column"===o.flexDirection||"column-reverse"===o.flexDirection?"vertical":"horizontal";if("grid"===o.display)return o.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(n&&r.float&&"none"!==r.float){var d="left"===r.float?"left":"right";return!i||"both"!==s.clear&&s.clear!==d?"horizontal":"vertical"}return n&&("block"===r.display||"flex"===r.display||"table"===r.display||"grid"===r.display||a<=l&&"none"===o[De]||i&&"none"===o[De]&&a<l+c)?"vertical":"horizontal"},Ee=function(t){function o(e,t){return function(a,n,i,r){var s=a.options.group.name&&n.options.group.name&&a.options.group.name===n.options.group.name;if(null==e&&(t||s))return!0;if(null==e||!1===e)return!1;if(t&&"clone"===e)return e;if("function"==typeof e)return o(e(a,n,i,r),t)(a,n,i,r);var l=(t?a:n).options.group.name;return!0===e||"string"==typeof e&&e===l||e.join&&-1<e.indexOf(l)}}var a={},n=t.group;n&&"object"==e(n)||(n={name:n}),a.name=n.name,a.checkPull=o(n.pull,!0),a.checkPut=o(n.put),a.revertClone=n.revertClone,t.group=a},Ie=function(){!Te&&X&&w(X,"display","none")},Fe=function(){!Te&&X&&w(X,"display","")};function Oe(e){if(G){var t=function(e,t){var o;return ve.some((function(a){if(!T(a)){var n=x(a),i=a[W].options.emptyInsertThreshold,r=e>=n.left-i&&e<=n.right+i,s=t>=n.top-i&&t<=n.bottom+i;return i&&r&&s?o=a:void 0}})),o}((e=e.touches?e.touches[0]:e).clientX,e.clientY);if(t){var o={};for(var a in e)e.hasOwnProperty(a)&&(o[a]=e[a]);o.target=o.rootEl=t,o.preventDefault=void 0,o.stopPropagation=void 0,t[W]._onDragOver(o)}}}function Pe(e){G&&G.parentNode[W]._isOutsideThisEl(e.target)}function ze(e,a){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=a=t({},a),e[W]=this;var n={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Me(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==ze.supportPointer&&"PointerEvent"in window&&!c,emptyInsertThreshold:5};for(var i in L.initializePlugins(this,e,n),n)i in a||(a[i]=n[i]);for(var r in Ee(a),this)"_"===r.charAt(0)&&"function"==typeof this[r]&&(this[r]=this[r].bind(this));this.nativeDraggable=!a.forceFallback&&ke,this.nativeDraggable&&(this.options.touchStartThreshold=1),a.supportPointer?h(e,"pointerdown",this._onTapStart):(h(e,"mousedown",this._onTapStart),h(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(h(e,"dragover",this),h(e,"dragenter",this)),ve.push(this.el),a.store&&a.store.get&&this.sort(a.store.get(this)||[]),t(this,function(){var e,t=[];return{captureAnimationState:function(){t=[],this.options.animation&&[].slice.call(this.el.children).forEach((function(e){if("none"!==w(e,"display")&&e!==ze.ghost){t.push({target:e,rect:x(e)});var a=o({},t[t.length-1].rect);if(e.thisAnimationDuration){var n=y(e,!0);n&&(a.top-=n.f,a.left-=n.e)}e.fromRect=a}}))},addAnimationState:function(e){t.push(e)},removeAnimationState:function(e){t.splice(function(e,t){for(var o in e)if(e.hasOwnProperty(o))for(var a in t)if(t.hasOwnProperty(a)&&t[a]===e[o][a])return Number(o);return-1}(t,{target:e}),1)},animateAll:function(o){var a=this;if(!this.options.animation)return clearTimeout(e),void("function"==typeof o&&o());var n=!1,i=0;t.forEach((function(e){var t=0,o=e.target,r=o.fromRect,s=x(o),l=o.prevFromRect,c=o.prevToRect,d=e.rect,u=y(o,!0);u&&(s.top-=u.f,s.left-=u.e),o.toRect=s,o.thisAnimationDuration&&F(l,s)&&!F(r,s)&&(d.top-s.top)/(d.left-s.left)==(r.top-s.top)/(r.left-s.left)&&(t=function(e,t,o,a){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-o.top,2)+Math.pow(t.left-o.left,2))*a.animation}(d,l,c,a.options)),F(s,r)||(o.prevFromRect=r,o.prevToRect=s,t||(t=a.options.animation),a.animate(o,d,s,t)),t&&(n=!0,i=Math.max(i,t),clearTimeout(o.animationResetTimer),o.animationResetTimer=setTimeout((function(){o.animationTime=0,o.prevFromRect=null,o.fromRect=null,o.prevToRect=null,o.thisAnimationDuration=null}),t),o.thisAnimationDuration=t)})),clearTimeout(e),n?e=setTimeout((function(){"function"==typeof o&&o()}),i):"function"==typeof o&&o(),t=[]},animate:function(e,t,o,a){if(a){w(e,"transition",""),w(e,"transform","");var n=y(this.el),i=n&&n.a,r=n&&n.d,s=(t.left-o.left)/(i||1),l=(t.top-o.top)/(r||1);e.animatingX=!!s,e.animatingY=!!l,w(e,"transform","translate3d("+s+"px,"+l+"px,0)"),this.forRepaintDummy=function(e){return e.offsetWidth}(e),w(e,"transition","transform "+a+"ms"+(this.options.easing?" "+this.options.easing:"")),w(e,"transform","translate3d(0,0,0)"),"number"==typeof e.animated&&clearTimeout(e.animated),e.animated=setTimeout((function(){w(e,"transition",""),w(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1}),a)}}}}())}function _e(e,t,o,a,n,i,l,c){var d,u,p=e[W],h=p.options.onMove;return!window.CustomEvent||r||s?(d=document.createEvent("Event")).initEvent("move",!0,!0):d=new CustomEvent("move",{bubbles:!0,cancelable:!0}),d.to=t,d.from=e,d.dragged=o,d.draggedRect=a,d.related=n||t,d.relatedRect=i||x(t),d.willInsertAfter=c,d.originalEvent=l,e.dispatchEvent(d),h&&(u=h.call(p,d,l)),u}function Ae(e){e.draggable=!1}function We(){ye=!1}function Ne(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,o=t.length,a=0;o--;)a+=t.charCodeAt(o);return a.toString(36)}function Re(e){return setTimeout(e,0)}function Le(e){return clearTimeout(e)}Ce&&document.addEventListener("click",(function(e){if(ge)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),ge=!1}),!0),ze.prototype={constructor:ze,_isOutsideThisEl:function(e){this.el.contains(e)||e===this.el||(ue=null)},_getDirection:function(e,t){return"function"==typeof this.options.direction?this.options.direction.call(this,e,t,G):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,o=this.el,a=this.options,n=a.preventOnFilter,i=e.type,r=e.touches&&e.touches[0]||e.pointerType&&"touch"===e.pointerType&&e,s=(r||e).target,l=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||s,d=a.filter;if(function(e){Se.length=0;for(var t=e.getElementsByTagName("input"),o=t.length;o--;){var a=t[o];a.checked&&Se.push(a)}}(o),!G&&!(/mousedown|pointerdown/.test(i)&&0!==e.button||a.disabled)&&!l.isContentEditable&&(this.nativeDraggable||!c||!s||"SELECT"!==s.tagName.toUpperCase())&&!((s=g(s,a.draggable,o,!1))&&s.animated||Z===s)){if(K=M(s),ee=M(s,a.draggable),"function"==typeof d){if(d.call(this,e,s,this))return B({sortable:t,rootEl:l,name:"filter",targetEl:s,toEl:o,fromEl:o}),H("filter",t,{evt:e}),void(n&&e.cancelable&&e.preventDefault())}else if(d&&(d=d.split(",").some((function(a){if(a=g(l,a.trim(),o,!1))return B({sortable:t,rootEl:a,name:"filter",targetEl:s,fromEl:o,toEl:o}),H("filter",t,{evt:e}),!0}))))return void(n&&e.cancelable&&e.preventDefault());a.handle&&!g(l,a.handle,o,!1)||this._prepareDragStart(e,r,s)}}},_prepareDragStart:function(e,t,o){var a,n=this,i=n.el,c=n.options,d=i.ownerDocument;if(o&&!G&&o.parentNode===i){var u=x(o);if(Y=i,V=(G=o).parentNode,q=G.nextSibling,Z=o,oe=c.group,ne={target:ze.dragged=G,clientX:(t||e).clientX,clientY:(t||e).clientY},le=ne.clientX-u.left,ce=ne.clientY-u.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,G.style["will-change"]="all",a=function(){H("delayEnded",n,{evt:e}),ze.eventCanceled?n._onDrop():(n._disableDelayedDragEvents(),!l&&n.nativeDraggable&&(G.draggable=!0),n._triggerDragStart(e,t),B({sortable:n,name:"choose",originalEvent:e}),$(G,c.chosenClass,!0))},c.ignore.split(",").forEach((function(e){S(G,e.trim(),Ae)})),h(d,"dragover",Oe),h(d,"mousemove",Oe),h(d,"touchmove",Oe),h(d,"mouseup",n._onDrop),h(d,"touchend",n._onDrop),h(d,"touchcancel",n._onDrop),l&&this.nativeDraggable&&(this.options.touchStartThreshold=4,G.draggable=!0),H("delayStart",this,{evt:e}),!c.delay||c.delayOnTouchOnly&&!t||this.nativeDraggable&&(s||r))a();else{if(ze.eventCanceled)return void this._onDrop();h(d,"mouseup",n._disableDelayedDrag),h(d,"touchend",n._disableDelayedDrag),h(d,"touchcancel",n._disableDelayedDrag),h(d,"mousemove",n._delayedDragTouchMoveHandler),h(d,"touchmove",n._delayedDragTouchMoveHandler),c.supportPointer&&h(d,"pointermove",n._delayedDragTouchMoveHandler),n._dragStartTimer=setTimeout(a,c.delay)}}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){G&&Ae(G),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;f(e,"mouseup",this._disableDelayedDrag),f(e,"touchend",this._disableDelayedDrag),f(e,"touchcancel",this._disableDelayedDrag),f(e,"mousemove",this._delayedDragTouchMoveHandler),f(e,"touchmove",this._delayedDragTouchMoveHandler),f(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||"touch"==e.pointerType&&e,!this.nativeDraggable||t?this.options.supportPointer?h(document,"pointermove",this._onTouchMove):h(document,t?"touchmove":"mousemove",this._onTouchMove):(h(G,"dragend",this),h(Y,"dragstart",this._onDragStart));try{document.selection?Re((function(){document.selection.empty()})):window.getSelection().removeAllRanges()}catch(e){}},_dragStarted:function(e,t){if(me=!1,Y&&G){H("dragStarted",this,{evt:t}),this.nativeDraggable&&h(document,"dragover",Pe);var o=this.options;e||$(G,o.dragClass,!1),$(G,o.ghostClass,!0),ze.active=this,e&&this._appendGhost(),B({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(ie){this._lastX=ie.clientX,this._lastY=ie.clientY,Ie();for(var e=document.elementFromPoint(ie.clientX,ie.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(ie.clientX,ie.clientY))!==t;)t=e;if(G.parentNode[W]._isOutsideThisEl(e),t)do{if(t[W]&&t[W]._onDragOver({clientX:ie.clientX,clientY:ie.clientY,target:e,rootEl:t})&&!this.options.dragoverBubble)break;e=t}while(t=t.parentNode);Fe()}},_onTouchMove:function(e){if(ne){var t=this.options,o=t.fallbackTolerance,a=t.fallbackOffset,n=e.touches?e.touches[0]:e,i=X&&y(X,!0),r=X&&i&&i.a,s=X&&i&&i.d,l=xe&&fe&&E(fe),c=(n.clientX-ne.clientX+a.x)/(r||1)+(l?l[0]-we[0]:0)/(r||1),d=(n.clientY-ne.clientY+a.y)/(s||1)+(l?l[1]-we[1]:0)/(s||1);if(!ze.active&&!me){if(o&&Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))<o)return;this._onDragStart(e,!0)}if(X){i?(i.e+=c-(re||0),i.f+=d-(se||0)):i={a:1,b:0,c:0,d:1,e:c,f:d};var u="matrix(".concat(i.a,",").concat(i.b,",").concat(i.c,",").concat(i.d,",").concat(i.e,",").concat(i.f,")");w(X,"webkitTransform",u),w(X,"mozTransform",u),w(X,"msTransform",u),w(X,"transform",u),re=c,se=d,ie=n}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!X){var e=this.options.fallbackOnBody?document.body:Y,t=x(G,!0,xe,!0,e),o=this.options;if(xe){for(fe=e;"static"===w(fe,"position")&&"none"===w(fe,"transform")&&fe!==document;)fe=fe.parentNode;fe!==document.body&&fe!==document.documentElement?(fe===document&&(fe=C()),t.top+=fe.scrollTop,t.left+=fe.scrollLeft):fe=C(),we=E(fe)}$(X=G.cloneNode(!0),o.ghostClass,!1),$(X,o.fallbackClass,!0),$(X,o.dragClass,!0),w(X,"transition",""),w(X,"transform",""),w(X,"box-sizing","border-box"),w(X,"margin",0),w(X,"top",t.top),w(X,"left",t.left),w(X,"width",t.width),w(X,"height",t.height),w(X,"opacity","0.8"),w(X,"position",xe?"absolute":"fixed"),w(X,"zIndex","100000"),w(X,"pointerEvents","none"),ze.ghost=X,e.appendChild(X),w(X,"transform-origin",le/parseInt(X.style.width)*100+"% "+ce/parseInt(X.style.height)*100+"%")}},_onDragStart:function(e,t){var o=this,a=e.dataTransfer,n=o.options;H("dragStart",this,{evt:e}),ze.eventCanceled?this._onDrop():(H("setupClone",this),ze.eventCanceled||((j=z(G)).draggable=!1,j.style["will-change"]="",this._hideClone(),$(j,this.options.chosenClass,!1),ze.clone=j),o.cloneId=Re((function(){H("clone",o),ze.eventCanceled||(o.options.removeCloneOnHide||Y.insertBefore(j,G),o._hideClone(),B({sortable:o,name:"clone"}))})),t||$(G,n.dragClass,!0),t?(ge=!0,o._loopId=setInterval(o._emulateDragOver,50)):(f(document,"mouseup",o._onDrop),f(document,"touchend",o._onDrop),f(document,"touchcancel",o._onDrop),a&&(a.effectAllowed="move",n.setData&&n.setData.call(o,a,G)),h(document,"drop",o),w(G,"transform","translateZ(0)")),me=!0,o._dragStartId=Re(o._dragStarted.bind(o,t,e)),h(document,"selectstart",o),de=!0,c&&w(document.body,"user-select","none"))},_onDragOver:function(e){var t,a,n,i,r=this.el,s=e.target,l=this.options,c=l.group,d=ze.active,u=oe===c,p=l.sort,h=ae||d,f=this,m=!1;if(!ye){if(void 0!==e.preventDefault&&e.cancelable&&e.preventDefault(),s=g(s,l.draggable,r,!0),N("dragOver"),ze.eventCanceled)return m;if(G.contains(e.target)||s.animated&&s.animatingX&&s.animatingY||f._ignoreWhileAnimating===s)return L(!1);if(ge=!1,d&&!l.disabled&&(u?p||(n=!Y.contains(G)):ae===this||(this.lastPutMode=oe.checkPull(this,d,G,e))&&c.checkPut(this,d,G,e))){if(i="vertical"===this._getDirection(e,s),t=x(G),N("dragOverValid"),ze.eventCanceled)return m;if(n)return V=Y,R(),this._hideClone(),N("revert"),ze.eventCanceled||(q?Y.insertBefore(G,q):Y.appendChild(G)),L(!0);var v=T(r,l.draggable);if(!v||function(e,t,o){var a=x(T(o.el,o.options.draggable));return t?e.clientX>a.right+10||e.clientX<=a.right&&e.clientY>a.bottom&&e.clientX>=a.left:e.clientX>a.right&&e.clientY>a.top||e.clientX<=a.right&&e.clientY>a.bottom+10}(e,i,this)&&!v.animated){if(v===G)return L(!1);if(v&&r===e.target&&(s=v),s&&(a=x(s)),!1!==_e(Y,r,G,t,s,a,e,!!s))return R(),r.appendChild(G),V=r,U(),L(!0)}else if(s.parentNode===r){a=x(s);var b,y,S,C=G.parentNode!==r,k=!function(e,t,o){var a=o?e.left:e.top,n=o?e.right:e.bottom,i=o?e.width:e.height,r=o?t.left:t.top,s=o?t.right:t.bottom,l=o?t.width:t.height;return a===r||n===s||a+i/2===r+l/2}(G.animated&&G.toRect||t,s.animated&&s.toRect||a,i),E=i?"top":"left",I=D(s,"top","top")||D(G,"top","top"),F=I?I.scrollTop:void 0;if(ue!==s&&(y=a[E],be=!1,$e=!k&&l.invertSwap||C),0!==(b=function(e,t,o,a,n,i,r,s){var l=a?e.clientY:e.clientX,c=a?o.height:o.width,d=a?o.top:o.left,u=a?o.bottom:o.right,p=!1;if(!r)if(s&&he<c*n){if(!be&&(1===pe?d+c*i/2<l:l<u-c*i/2)&&(be=!0),be)p=!0;else if(1===pe?l<d+he:u-he<l)return-pe}else if(d+c*(1-n)/2<l&&l<u-c*(1-n)/2)return function(e){return M(G)<M(e)?1:-1}(t);return(p=p||r)&&(l<d+c*i/2||u-c*i/2<l)?d+c/2<l?1:-1:0}(e,s,a,i,k?1:l.swapThreshold,null==l.invertedSwapThreshold?l.swapThreshold:l.invertedSwapThreshold,$e,ue===s)))for(var O=M(G);O-=b,(S=V.children[O])&&("none"===w(S,"display")||S===X););if(0===b||S===s)return L(!1);pe=b;var z=(ue=s).nextElementSibling,_=!1,A=_e(Y,r,G,t,s,a,e,_=1===b);if(!1!==A)return 1!==A&&-1!==A||(_=1===A),ye=!0,setTimeout(We,30),R(),_&&!z?r.appendChild(G):s.parentNode.insertBefore(G,_?z:s),I&&P(I,0,F-I.scrollTop),V=G.parentNode,void 0===y||$e||(he=Math.abs(y-x(s)[E])),U(),L(!0)}if(r.contains(G))return L(!1)}return!1}function N(l,c){H(l,f,o({evt:e,isOwner:u,axis:i?"vertical":"horizontal",revert:n,dragRect:t,targetRect:a,canSort:p,fromSortable:h,target:s,completed:L,onMove:function(o,a){return _e(Y,r,G,t,o,x(o),e,a)},changed:U},c))}function R(){N("dragOverAnimationCapture"),f.captureAnimationState(),f!==h&&h.captureAnimationState()}function L(t){return N("dragOverCompleted",{insertion:t}),t&&(u?d._hideClone():d._showClone(f),f!==h&&($(G,ae?ae.options.ghostClass:d.options.ghostClass,!1),$(G,l.ghostClass,!0)),ae!==f&&f!==ze.active?ae=f:f===ze.active&&ae&&(ae=null),h===f&&(f._ignoreWhileAnimating=s),f.animateAll((function(){N("dragOverAnimationComplete"),f._ignoreWhileAnimating=null})),f!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(s===G&&!G.animated||s===r&&!s.animated)&&(ue=null),l.dragoverBubble||e.rootEl||s===document||(G.parentNode[W]._isOutsideThisEl(e.target),t||Oe(e)),!l.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),m=!0}function U(){Q=M(G),te=M(G,l.draggable),B({sortable:f,name:"change",toEl:r,newIndex:Q,newDraggableIndex:te,originalEvent:e})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){f(document,"mousemove",this._onTouchMove),f(document,"touchmove",this._onTouchMove),f(document,"pointermove",this._onTouchMove),f(document,"dragover",Oe),f(document,"mousemove",Oe),f(document,"touchmove",Oe)},_offUpEvents:function(){var e=this.el.ownerDocument;f(e,"mouseup",this._onDrop),f(e,"touchend",this._onDrop),f(e,"pointerup",this._onDrop),f(e,"touchcancel",this._onDrop),f(document,"selectstart",this)},_onDrop:function(e){var t=this.el,o=this.options;Q=M(G),te=M(G,o.draggable),H("drop",this,{evt:e}),V=G&&G.parentNode,Q=M(G),te=M(G,o.draggable),ze.eventCanceled||(be=$e=me=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Le(this.cloneId),Le(this._dragStartId),this.nativeDraggable&&(f(document,"drop",this),f(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),c&&w(document.body,"user-select",""),w(G,"transform",""),e&&(de&&(e.cancelable&&e.preventDefault(),o.dropBubble||e.stopPropagation()),X&&X.parentNode&&X.parentNode.removeChild(X),(Y===V||ae&&"clone"!==ae.lastPutMode)&&j&&j.parentNode&&j.parentNode.removeChild(j),G&&(this.nativeDraggable&&f(G,"dragend",this),Ae(G),G.style["will-change"]="",de&&!me&&$(G,ae?ae.options.ghostClass:this.options.ghostClass,!1),$(G,this.options.chosenClass,!1),B({sortable:this,name:"unchoose",toEl:V,newIndex:null,newDraggableIndex:null,originalEvent:e}),Y!==V?(0<=Q&&(B({rootEl:V,name:"add",toEl:V,fromEl:Y,originalEvent:e}),B({sortable:this,name:"remove",toEl:V,originalEvent:e}),B({rootEl:V,name:"sort",toEl:V,fromEl:Y,originalEvent:e}),B({sortable:this,name:"sort",toEl:V,originalEvent:e})),ae&&ae.save()):Q!==K&&0<=Q&&(B({sortable:this,name:"update",toEl:V,originalEvent:e}),B({sortable:this,name:"sort",toEl:V,originalEvent:e})),ze.active&&(null!=Q&&-1!==Q||(Q=K,te=ee),B({sortable:this,name:"end",toEl:V,originalEvent:e}),this.save())))),this._nulling()},_nulling:function(){H("nulling",this),Y=G=V=X=q=j=Z=J=ne=ie=de=Q=te=K=ee=ue=pe=ae=oe=ze.dragged=ze.ghost=ze.clone=ze.active=null,Se.forEach((function(e){e.checked=!0})),Se.length=re=se=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":G&&(this._onDragOver(e),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move"),e.cancelable&&e.preventDefault()}(e));break;case"selectstart":e.preventDefault()}},toArray:function(){for(var e,t=[],o=this.el.children,a=0,n=o.length,i=this.options;a<n;a++)g(e=o[a],i.draggable,this.el,!1)&&t.push(e.getAttribute(i.dataIdAttr)||Ne(e));return t},sort:function(e,t){var o={},a=this.el;this.toArray().forEach((function(e,t){var n=a.children[t];g(n,this.options.draggable,a,!1)&&(o[e]=n)}),this),t&&this.captureAnimationState(),e.forEach((function(e){o[e]&&(a.removeChild(o[e]),a.appendChild(o[e]))})),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return g(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var o=this.options;if(void 0===t)return o[e];var a=L.modifyOption(this,e,t);o[e]=void 0!==a?a:t,"group"===e&&Ee(o)},destroy:function(){H("destroy",this);var e=this.el;e[W]=null,f(e,"mousedown",this._onTapStart),f(e,"touchstart",this._onTapStart),f(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(f(e,"dragover",this),f(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),(function(e){e.removeAttribute("draggable")})),this._onDrop(),this._disableDelayedDragEvents(),ve.splice(ve.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!J){if(H("hideClone",this),ze.eventCanceled)return;w(j,"display","none"),this.options.removeCloneOnHide&&j.parentNode&&j.parentNode.removeChild(j),J=!0}},_showClone:function(e){if("clone"===e.lastPutMode){if(J){if(H("showClone",this),ze.eventCanceled)return;G.parentNode!=Y||this.options.group.revertClone?q?Y.insertBefore(j,q):Y.appendChild(j):Y.insertBefore(j,G),this.options.group.revertClone&&this.animate(G,j),w(j,"display",""),J=!1}}else this._hideClone()}},Ce&&h(document,"touchmove",(function(e){(ze.active||me)&&e.cancelable&&e.preventDefault()})),ze.utils={on:h,off:f,css:w,find:S,is:function(e,t){return!!g(e,t,e,!1)},extend:function(e,t){if(e&&t)for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);return e},throttle:O,closest:g,toggleClass:$,clone:z,index:M,nextTick:Re,cancelNextTick:Le,detectDirection:Me,getChild:k},ze.get=function(e){return e[W]},ze.mount=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];t[0].constructor===Array&&(t=t[0]),t.forEach((function(e){if(!e.prototype||!e.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(e));e.utils&&(ze.utils=o({},ze.utils,e.utils)),L.mount(e)}))},ze.create=function(e,t){return new ze(e,t)};var Ue,He,Be,Ge,Ve,Xe,Ye=[],qe=!(ze.version="1.13.0");function Ze(){Ye.forEach((function(e){clearInterval(e.pid)})),Ye=[]}function je(){clearInterval(Xe)}function Je(e){var t=e.originalEvent,o=e.putSortable,a=e.dragEl,n=e.activeSortable,i=e.dispatchSortableEvent,r=e.hideGhostForTarget,s=e.unhideGhostForTarget;if(t){var l=o||n;r();var c=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,d=document.elementFromPoint(c.clientX,c.clientY);s(),l&&!l.el.contains(d)&&(i("spill"),this.onSpill({dragEl:a,putSortable:o}))}}var Ke,Qe=O((function(e,t,o,a){if(t.scroll){var n,i=(e.touches?e.touches[0]:e).clientX,r=(e.touches?e.touches[0]:e).clientY,s=t.scrollSensitivity,l=t.scrollSpeed,c=C(),d=!1;He!==o&&(He=o,Ze(),Ue=t.scroll,n=t.scrollFn,!0===Ue&&(Ue=I(o,!0)));var u=0,p=Ue;do{var h,f=p,m=x(f),g=m.top,v=m.bottom,b=m.left,$=m.right,y=m.width,S=m.height,D=void 0,k=f.scrollWidth,T=f.scrollHeight,M=w(f),E=f.scrollLeft,F=f.scrollTop;h=f===c?(D=y<k&&("auto"===M.overflowX||"scroll"===M.overflowX||"visible"===M.overflowX),S<T&&("auto"===M.overflowY||"scroll"===M.overflowY||"visible"===M.overflowY)):(D=y<k&&("auto"===M.overflowX||"scroll"===M.overflowX),S<T&&("auto"===M.overflowY||"scroll"===M.overflowY));var O=D&&(Math.abs($-i)<=s&&E+y<k)-(Math.abs(b-i)<=s&&!!E),z=h&&(Math.abs(v-r)<=s&&F+S<T)-(Math.abs(g-r)<=s&&!!F);if(!Ye[u])for(var _=0;_<=u;_++)Ye[_]||(Ye[_]={});Ye[u].vx==O&&Ye[u].vy==z&&Ye[u].el===f||(Ye[u].el=f,Ye[u].vx=O,Ye[u].vy=z,clearInterval(Ye[u].pid),0==O&&0==z||(d=!0,Ye[u].pid=setInterval(function(){a&&0===this.layer&&ze.active._onTouchMove(Ve);var t=Ye[this.layer].vy?Ye[this.layer].vy*l:0,o=Ye[this.layer].vx?Ye[this.layer].vx*l:0;"function"==typeof n&&"continue"!==n.call(ze.dragged.parentNode[W],o,t,e,Ve,Ye[this.layer].el)||P(Ye[this.layer].el,o,t)}.bind({layer:u}),24))),u++}while(t.bubbleScroll&&p!==c&&(p=I(p,!1)));qe=d}}),30);function et(){}function tt(){}et.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,o=e.putSortable;this.sortable.captureAnimationState(),o&&o.captureAnimationState();var a=k(this.sortable.el,this.startIndex,this.options);a?this.sortable.el.insertBefore(t,a):this.sortable.el.appendChild(t),this.sortable.animateAll(),o&&o.animateAll()},drop:Je},t(et,{pluginName:"revertOnSpill"}),tt.prototype={onSpill:function(e){var t=e.dragEl,o=e.putSortable||this.sortable;o.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),o.animateAll()},drop:Je},t(tt,{pluginName:"removeOnSpill"});var ot,at,nt,it,rt,st=[],lt=[],ct=!1,dt=!1,ut=!1;function pt(e,t){lt.forEach((function(o,a){var n=t.children[o.sortableIndex+(e?Number(a):0)];n?t.insertBefore(o,n):t.appendChild(o)}))}function ht(){st.forEach((function(e){e!==nt&&e.parentNode&&e.parentNode.removeChild(e)}))}return ze.mount(new function(){function e(){for(var e in this.defaults={scroll:!0,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===e.charAt(0)&&"function"==typeof this[e]&&(this[e]=this[e].bind(this))}return e.prototype={dragStarted:function(e){var t=e.originalEvent;this.sortable.nativeDraggable?h(document,"dragover",this._handleAutoScroll):this.options.supportPointer?h(document,"pointermove",this._handleFallbackAutoScroll):t.touches?h(document,"touchmove",this._handleFallbackAutoScroll):h(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var t=e.originalEvent;this.options.dragOverBubble||t.rootEl||this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?f(document,"dragover",this._handleAutoScroll):(f(document,"pointermove",this._handleFallbackAutoScroll),f(document,"touchmove",this._handleFallbackAutoScroll),f(document,"mousemove",this._handleFallbackAutoScroll)),je(),Ze(),clearTimeout(v),v=void 0},nulling:function(){Ve=He=Ue=qe=Xe=Be=Ge=null,Ye.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,t){var o=this,a=(e.touches?e.touches[0]:e).clientX,n=(e.touches?e.touches[0]:e).clientY,i=document.elementFromPoint(a,n);if(Ve=e,t||s||r||c){Qe(e,this.options,i,t);var l=I(i,!0);!qe||Xe&&a===Be&&n===Ge||(Xe&&je(),Xe=setInterval((function(){var i=I(document.elementFromPoint(a,n),!0);i!==l&&(l=i,Ze()),Qe(e,o.options,i,t)}),10),Be=a,Ge=n)}else{if(!this.options.bubbleScroll||I(i,!0)===C())return void Ze();Qe(e,this.options,I(i,!1),!1)}}},t(e,{pluginName:"scroll",initializeByDefault:!0})}),ze.mount(tt,et),ze.mount(new function(){function e(){this.defaults={swapClass:"sortable-swap-highlight"}}return e.prototype={dragStart:function(e){var t=e.dragEl;Ke=t},dragOverValid:function(e){var t=e.completed,o=e.target,a=e.onMove,n=e.activeSortable,i=e.changed,r=e.cancel;if(n.options.swap){var s=this.sortable.el,l=this.options;if(o&&o!==s){var c=Ke;Ke=!1!==a(o)?($(o,l.swapClass,!0),o):null,c&&c!==Ke&&$(c,l.swapClass,!1)}i(),t(!0),r()}},drop:function(e){var t=e.activeSortable,o=e.putSortable,a=e.dragEl,n=o||this.sortable,i=this.options;Ke&&$(Ke,i.swapClass,!1),Ke&&(i.swap||o&&o.options.swap)&&a!==Ke&&(n.captureAnimationState(),n!==t&&t.captureAnimationState(),function(e,t){var o,a,n=e.parentNode,i=t.parentNode;n&&i&&!n.isEqualNode(t)&&!i.isEqualNode(e)&&(o=M(e),a=M(t),n.isEqualNode(i)&&o<a&&a++,n.insertBefore(t,n.children[o]),i.insertBefore(e,i.children[a]))}(a,Ke),n.animateAll(),n!==t&&t.animateAll())},nulling:function(){Ke=null}},t(e,{pluginName:"swap",eventProperties:function(){return{swapItem:Ke}}})}),ze.mount(new function(){function e(e){for(var t in this)"_"===t.charAt(0)&&"function"==typeof this[t]&&(this[t]=this[t].bind(this));e.options.supportPointer?h(document,"pointerup",this._deselectMultiDrag):(h(document,"mouseup",this._deselectMultiDrag),h(document,"touchend",this._deselectMultiDrag)),h(document,"keydown",this._checkKeyDown),h(document,"keyup",this._checkKeyUp),this.defaults={selectedClass:"sortable-selected",multiDragKey:null,setData:function(t,o){var a="";st.length&&at===e?st.forEach((function(e,t){a+=(t?", ":"")+e.textContent})):a=o.textContent,t.setData("Text",a)}}}return e.prototype={multiDragKeyDown:!1,isMultiDrag:!1,delayStartGlobal:function(e){var t=e.dragEl;nt=t},delayEnded:function(){this.isMultiDrag=~st.indexOf(nt)},setupClone:function(e){var t=e.sortable,o=e.cancel;if(this.isMultiDrag){for(var a=0;a<st.length;a++)lt.push(z(st[a])),lt[a].sortableIndex=st[a].sortableIndex,lt[a].draggable=!1,lt[a].style["will-change"]="",$(lt[a],this.options.selectedClass,!1),st[a]===nt&&$(lt[a],this.options.chosenClass,!1);t._hideClone(),o()}},clone:function(e){var t=e.sortable,o=e.rootEl,a=e.dispatchSortableEvent,n=e.cancel;this.isMultiDrag&&(this.options.removeCloneOnHide||st.length&&at===t&&(pt(!0,o),a("clone"),n()))},showClone:function(e){var t=e.cloneNowShown,o=e.rootEl,a=e.cancel;this.isMultiDrag&&(pt(!1,o),lt.forEach((function(e){w(e,"display","")})),t(),rt=!1,a())},hideClone:function(e){var t=this,o=(e.sortable,e.cloneNowHidden),a=e.cancel;this.isMultiDrag&&(lt.forEach((function(e){w(e,"display","none"),t.options.removeCloneOnHide&&e.parentNode&&e.parentNode.removeChild(e)})),o(),rt=!0,a())},dragStartGlobal:function(e){e.sortable,!this.isMultiDrag&&at&&at.multiDrag._deselectMultiDrag(),st.forEach((function(e){e.sortableIndex=M(e)})),st=st.sort((function(e,t){return e.sortableIndex-t.sortableIndex})),ut=!0},dragStarted:function(e){var t=this,o=e.sortable;if(this.isMultiDrag){if(this.options.sort&&(o.captureAnimationState(),this.options.animation)){st.forEach((function(e){e!==nt&&w(e,"position","absolute")}));var a=x(nt,!1,!0,!0);st.forEach((function(e){e!==nt&&_(e,a)})),ct=dt=!0}o.animateAll((function(){ct=dt=!1,t.options.animation&&st.forEach((function(e){A(e)})),t.options.sort&&ht()}))}},dragOver:function(e){var t=e.target,o=e.completed,a=e.cancel;dt&&~st.indexOf(t)&&(o(!1),a())},revert:function(e){var t=e.fromSortable,o=e.rootEl,a=e.sortable,n=e.dragRect;1<st.length&&(st.forEach((function(e){a.addAnimationState({target:e,rect:dt?x(e):n}),A(e),e.fromRect=n,t.removeAnimationState(e)})),dt=!1,function(e,t){st.forEach((function(o,a){var n=t.children[o.sortableIndex+(e?Number(a):0)];n?t.insertBefore(o,n):t.appendChild(o)}))}(!this.options.removeCloneOnHide,o))},dragOverCompleted:function(e){var t=e.sortable,o=e.isOwner,a=e.insertion,n=e.activeSortable,i=e.parentEl,r=e.putSortable,s=this.options;if(a){if(o&&n._hideClone(),ct=!1,s.animation&&1<st.length&&(dt||!o&&!n.options.sort&&!r)){var l=x(nt,!1,!0,!0);st.forEach((function(e){e!==nt&&(_(e,l),i.appendChild(e))})),dt=!0}if(!o)if(dt||ht(),1<st.length){var c=rt;n._showClone(t),n.options.animation&&!rt&&c&&lt.forEach((function(e){n.addAnimationState({target:e,rect:it}),e.fromRect=it,e.thisAnimationDuration=null}))}else n._showClone(t)}},dragOverAnimationCapture:function(e){var o=e.dragRect,a=e.isOwner,n=e.activeSortable;if(st.forEach((function(e){e.thisAnimationDuration=null})),n.options.animation&&!a&&n.multiDrag.isMultiDrag){it=t({},o);var i=y(nt,!0);it.top-=i.f,it.left-=i.e}},dragOverAnimationComplete:function(){dt&&(dt=!1,ht())},drop:function(e){var t=e.originalEvent,o=e.rootEl,a=e.parentEl,n=e.sortable,i=e.dispatchSortableEvent,r=e.oldIndex,s=e.putSortable,l=s||this.sortable;if(t){var c=this.options,d=a.children;if(!ut)if(c.multiDragKey&&!this.multiDragKeyDown&&this._deselectMultiDrag(),$(nt,c.selectedClass,!~st.indexOf(nt)),~st.indexOf(nt))st.splice(st.indexOf(nt),1),ot=null,U({sortable:n,rootEl:o,name:"deselect",targetEl:nt,originalEvt:t});else{if(st.push(nt),U({sortable:n,rootEl:o,name:"select",targetEl:nt,originalEvt:t}),t.shiftKey&&ot&&n.el.contains(ot)){var u,p,h=M(ot),f=M(nt);if(~h&&~f&&h!==f)for(u=h<f?(p=h,f):(p=f,h+1);p<u;p++)~st.indexOf(d[p])||($(d[p],c.selectedClass,!0),st.push(d[p]),U({sortable:n,rootEl:o,name:"select",targetEl:d[p],originalEvt:t}))}else ot=nt;at=l}if(ut&&this.isMultiDrag){if((a[W].options.sort||a!==o)&&1<st.length){var m=x(nt),g=M(nt,":not(."+this.options.selectedClass+")");if(!ct&&c.animation&&(nt.thisAnimationDuration=null),l.captureAnimationState(),!ct&&(c.animation&&(nt.fromRect=m,st.forEach((function(e){if(e.thisAnimationDuration=null,e!==nt){var t=dt?x(e):m;e.fromRect=t,l.addAnimationState({target:e,rect:t})}}))),ht(),st.forEach((function(e){d[g]?a.insertBefore(e,d[g]):a.appendChild(e),g++})),r===M(nt))){var v=!1;st.forEach((function(e){e.sortableIndex===M(e)||(v=!0)})),v&&i("update")}st.forEach((function(e){A(e)})),l.animateAll()}at=l}(o===a||s&&"clone"!==s.lastPutMode)&&lt.forEach((function(e){e.parentNode&&e.parentNode.removeChild(e)}))}},nullingGlobal:function(){this.isMultiDrag=ut=!1,lt.length=0},destroyGlobal:function(){this._deselectMultiDrag(),f(document,"pointerup",this._deselectMultiDrag),f(document,"mouseup",this._deselectMultiDrag),f(document,"touchend",this._deselectMultiDrag),f(document,"keydown",this._checkKeyDown),f(document,"keyup",this._checkKeyUp)},_deselectMultiDrag:function(e){if(!(void 0!==ut&&ut||at!==this.sortable||e&&g(e.target,this.options.draggable,this.sortable.el,!1)||e&&0!==e.button))for(;st.length;){var t=st[0];$(t,this.options.selectedClass,!1),st.shift(),U({sortable:this.sortable,rootEl:this.sortable.el,name:"deselect",targetEl:t,originalEvt:e})}},_checkKeyDown:function(e){e.key===this.options.multiDragKey&&(this.multiDragKeyDown=!0)},_checkKeyUp:function(e){e.key===this.options.multiDragKey&&(this.multiDragKeyDown=!1)}},t(e,{pluginName:"multiDrag",utils:{select:function(e){var t=e.parentNode[W];t&&t.options.multiDrag&&!~st.indexOf(e)&&(at&&at!==t&&(at.multiDrag._deselectMultiDrag(),at=t),$(e,t.options.selectedClass,!0),st.push(e))},deselect:function(e){var t=e.parentNode[W],o=st.indexOf(e);t&&t.options.multiDrag&&~o&&($(e,t.options.selectedClass,!1),st.splice(o,1))}},eventProperties:function(){var e=this,t=[],o=[];return st.forEach((function(a){var n;t.push({multiDragElement:a,index:a.sortableIndex}),n=dt&&a!==nt?-1:dt?M(a,":not(."+e.options.selectedClass+")"):M(a),o.push({multiDragElement:a,index:n})})),{items:n(st),clones:[].concat(lt),oldIndicies:t,newIndicies:o}},optionListeners:{multiDragKey:function(e){return"ctrl"===(e=e.toLowerCase())?e="Control":1<e.length&&(e=e.charAt(0).toUpperCase()+e.substr(1)),e}}})}),ze}));var swapSortable,toastMain,toastVersion,lastTemperature1,lastTemperature2,lastHumidity1,lastHumidity2,lastHeater1,MAX_TOOLS=12,autoScroll=!0,historyIndex=-1,swapTools=new Array(MAX_TOOLS),toolColors=new Array(MAX_TOOLS),feedLoadState=new Array(MAX_TOOLS),stepperMappings=new Array(MAX_TOOLS),isTestRunning=!1,boardOptions=new Array,hasMultiservo=!1,hasSpoolmotors=!1,hasTmc=!1,hasV6S=!1,hasDDE=!1,hasNeoPixels=!1,hasExtCtrl=!1,hasSharedStepper=!1,hasLidState=!1,hasEStopMux=!1,hasSerialDisplay=!1,hasDryer=!1,tmcStatusInterval=0,testCancelled=0,lastFWVersion=0,lastWIVersion=0,curFWVersion=0,isShowingLoading=!1,isShowingUnloading=!1,versionMismatch=new Array,uploadCancelled=!1,moveCarrierG1=!1,isFeederLoaded=!1,smuffIsIdle=!1,curMS=0,newStepsMM=0,msItem="",tmcNotUsed=0,lastDlgId=0,usrDlgSelection=new Array,gotDlgButton=!1,loggingStart=0,statusTime=0,lastWiCmd=0;const githubUrl="technik-gegg.github.io",githubPrefix="https://"+githubUrl+"/SMuFF-WI";var sitePrefix="",NeoPixelCmd="WI-CMD:NPX:",NeoPixelCmdHeat="HEAT\n",NeoPixelCmdHeating="HEATING\n",NeoPixelCmdCool="COOL\n",NeoPixelCmdClear="CLEAR\n",NeoPixelCmdBPM120="BPM:120\n",NeoPixelCmdBPM12="BPM:12\n",cmdHeatSent=!1,cmdHeatingSent=!1,cmdCoolSent=!0,cmdClearSent=!0,colorNames=[{label:"Aqua",value:0},{label:"Azure",value:0},{label:"Beige",value:0},{label:"Bisque",value:0},{label:"Black",value:0},{label:"Blue",value:0},{label:"Brown",value:0},{label:"BurlyWood",value:0},{label:"Chartreuse",value:0},{label:"Chocolate",value:0},{label:"Coral",value:0},{label:"Cornsilk",value:0},{label:"Crimson",value:0},{label:"Cyan",value:0},{label:"DimGray",value:0},{label:"FireBrick",value:0},{label:"Fuchsia",value:0},{label:"Gainsboro",value:0},{label:"Gold",value:0},{label:"Gray",value:0},{label:"Green",value:0},{label:"Honeydew",value:0},{label:"Indigo",value:0},{label:"Ivory",value:0},{label:"Khaki",value:0},{label:"Lavender",value:0},{label:"Lime",value:0},{label:"Linen",value:0},{label:"Magenta",value:0},{label:"Maroon",value:0},{label:"MintCream",value:0},{label:"MistyRose",value:0},{label:"Moccasin",value:0},{label:"Navy",value:0},{label:"Olive",value:0},{label:"Orange",value:0},{label:"Orchid",value:0},{label:"Pink",value:0},{label:"Plum",value:0},{label:"Purple",value:0},{label:"Red",value:0},{label:"Sienna",value:0},{label:"Silver",value:0},{label:"Tan",value:0},{label:"Turquoise",value:0},{label:"Transparent",value:0},{label:"Violet",value:0},{label:"White",value:0},{label:"Yellow",value:0}],materialNames=[{label:"PLA",value:0},{label:"PETG",value:0},{label:"PC",value:0},{label:"PA",value:0},{label:"ASA",value:0},{label:"ABS",value:0},{label:"CF",value:0},{label:"PVA",value:0},{label:"Flex",value:0},{label:"HIPS",value:0}];function showConnectingMessage(e,t,o=null){$("#connecting-message").fadeOut(e,(function(){$("#connecting-message").html(t).fadeIn(e),null!=o&&o()}))}function initUI(){hideElement("#swap-tools-template-container"),hideElement("#materials-tool-template"),hideElement("#history-items-template-container"),hideElement("#console-templates"),hideElement("#materials-template"),hideElement("#servomap-template"),$("#top-info, #sec-dashboard, #sec-settings, #sec-swaptools, #sec-statusinfo, #sec-testrun, #sec-boardinfo, #sec-live-control, #sec-dryer").fadeOut("fast"),$("#content").css("padding-top","70px"),$("#nav-container").addClass("hidden"),$("#test-status").addClass("hidden"),$("#tmc-status").addClass("hidden"),$("#tmc-stat-0").addClass("hidden"),$("#tmc-stat-1").addClass("hidden"),$("#tmc-stat-2").addClass("hidden"),$("#tmc-stat-3").addClass("hidden"),hideElement("#toast-placement"),$("#btn-wizard").css("display","none"),$(".hasDuet3D").addClass("disabled"),$(".hasDuet3D").prop("disabled",!0),showChangesPending(!1),$("#tmcwarn-label").text(""),$("#version-label").text(""),$("#devname-label").text(""),$("#electronics-label").text(""),$("#mode-label").text(""),$("#console-text").text(""),$("#test-files").empty(),$("#test-files").append(new Option(localStorage.getItem("runningScript"),"")),$("#temp1-label").text("--"),$("#temp2-label").text("--"),$("#humidity1-label").text("--"),$("#humidity2-label").text("--"),$("#heater1-label").text("--"),$("#fan1-label").text("--"),$("#temp1-label-sec").text("--"),$("#temp2-label-sec").text("--"),$("#humidity1-label-sec").text("--"),$("#humidity2-label-sec").text("--"),$("#heater1-label-sec").text("--"),$("#heater1-target-label-sec").text("--"),$("#fan1-label-sec").text("--"),$("#fan2-label-sec").text("--"),sensor1Chart=document.querySelector("#ChartSensor1 > canvas").chart,sensor2Chart=document.querySelector("#ChartSensor2 > canvas").chart}function initUI2(){$("#relay-status").css("background-color",$(".card").css("color")),$("#relay-status").css("color",$(".card").css("background-color"))}function addSentGcode(e){if(null!=e){var t=$("#console-text-container"),o=$("#send-template").clone(!0);o.attr("id",""),o.removeClass("hidden"),o.text(e),t.append(o)}}async function addReceivedGcode(e){if(null!=e){$("#console-text-container span").length>3e3&&$("#console-text-container").find("span:first").remove();var t=$("#console-text-container"),o=$("#receive-template").clone(!0);o.attr("id",""),o.removeClass("hidden"),o.html(replaceTermAttr(e)),t.append(o),autoScroll&&(t[0].scrollTop=t[0].scrollHeight)}}function replaceTermAttr(e){var t=e.replace(/\x1b\[0m/g,"</span>");t=t.replace(/\x1b\[1m/g,'<span class="bold">');for(var o=/\x1b\[(\d+)m/g;m=o.exec(t);){var a="";m[1]>=30&&m[1]<=37?a="fgc"+m[1]:m[1]>=40&&m[1]<=47&&(a="bgc"+m[1]),t=t.replace(new RegExp("\\x1b\\["+m[1]+"m","g"),'<span class="'+a+'">')}return t}function createHistoryItem(e){if(null!=e){for(var t=0,o=$("#historyitemscontainer"),a=0;a<o.children().length;a++){var n=$(o.children()[a]).find("span").text();if(null!=n&&n.toUpperCase().trim()==e.toUpperCase().trim())return void(n.toUpperCase().trim()==e.toUpperCase().trim()&&(historyIndex=a));t++}var i=$("#history-item-template").clone(!0),r=i.find("span");r.attr("id",""),i.find("i").attr("id",""),r.text(e),i.attr("id","history-item-"+t),i.css("cursor","pointer"),o.append(i),historyIndex=o.children().length}}function showLoading(e){if(!seenError){var t=$("#tool-selection").val();if(-1!=t)showInfo(e?loadingFilament+t+loadingFilamentSpl+plzWait:loadingFilament+t+closeH2+plzWait),isShowingLoading=!0;$("#feeder-pwr-off").addClass("hidden")}}function showUnloading(e){if(!seenError){var t=$("#tool-selection").val();if(-1!=t)showInfo(e?unloadingFilament+t+unloadingFilamentSpl+plzWait:unloadingFilament+t+closeH2+plzWait),isShowingUnloading=!0;$("#feeder-pwr-off").addClass("hidden")}}function showPurging(e){if(""!=e){var t=e.matchAll(/([A-Z]:)(\d+.?\d*)/g),o=-1,a=0,n=0;for(const e of t)switch(e[1]){case"T:":o=parseInt(e[2]);break;case"L:":a=parseInt(e[2]);break;case"C:":n=parseFloat(e[2])}if(-1!=o){var i=purging1+o+purging2+a+purging3+n+purging4+plzWait;setTimeout((function(){showInfo(i)}),500)}}else cancelInfo()}$(document).ready((function(){$("#update-note").addClass("d-none"),$("#platform").addClass("d-none"),sitePrefix="";var e="";if(!location.host.startsWith(githubUrl)){if(console.log("Host: ",location.host),location.host.startsWith("localhost")||location.host.startsWith("127.0.0.1"))hideElement("#btn-OTA");else{isStandalone=!0,console.log("Running in standalone mode...");var t=location.origin;$('img[src^="assets/"]').each((function(){var e=$(this).prop("id");if("smuff-image"!==e&&"logo"!==e){var o=$(this).prop("src").replace(t,githubPrefix);o.indexOf("/wi/")>-1&&(o=o.replace("/wi/","")),$(this).prop("src",o)}})),sitePrefix=githubPrefix,console.log("Image sources changed to Github..."),$.get("/info",(function(t){console.log("Got version info: "+t),e=t.replaceAll("\n"," / ")}))}$.get("platform.txt",(function(t){var o=t+"<br/>"+e;$("#platform").html(o)})).fail((function(){location.host.startsWith("localhost")?$("#platform").text("Localhost"):$("#platform").text("Unknown Platform")})),$("#platform").removeClass("d-none"),curWIVersion=parseFloat($("#version-info").text().substring(1)),$.get(githubPrefix+"/wiversion.txt",(function(e){lastWIVersion=parseFloat(e),console.log("Lastest SMuFF-WI version: "+lastWIVersion),$("#update-note").text($("#update-note").text().replace("{VER}",lastWIVersion)),lastWIVersion>curWIVersion&&$("#update-note").removeClass("d-none")})).fail((function(){console.log("Not able to retrieve lastest SMuFF-WI version!"),$("#update-note").text(noWiVersion).removeClass("d-none")}))}$.get(githubPrefix+"/fwversion.txt",(function(e){console.log("Lastest SMuFF Firmware version: "+e),lastFWVersion=parseFloat(e)})),window.onscroll=function(){$(window).scrollTop()>35?($("#top-info").css("transform-origin","0 0"),$("#top-info").css("transform","scale(1, .65)"),$("#content").css("padding-top",hasDryer?"190px":"160px"),$("#settings-header").css("top","105px")):($("#top-info").css("transform","scale(1, 1)"),$("#content").css("padding-top",hasDryer?"230px":"200px"),$("#settings-header").css("top","200px"))};var o=$('<link href="'+$("#themes").val()+'" rel="stylesheet" />');if(o.appendTo("head"),null!=localStorage.getItem("Theme")){var a=localStorage.getItem("Theme");$("#themes").val(a),o.attr("href",a).promise().done((function(){initUI(),setTimeout((function(){initUI2()}),1e3)}))}else initUI(),initUI2(),initSensorCharts();for(var n=0;n<3;n++)versionMismatch[n]=0;$("#themes").on("change",(function(){o.attr("href",$(this).val()).promise().done((function(){setTimeout((function(){initUI2()}),1e3)})),localStorage.setItem("Theme",$(this).val())}));var i=[].slice.call(document.querySelectorAll(".toast")).map((function(e){return new bootstrap.Toast(e)}));toastVersion=i[0],toastMain=i[1],swapSortable=Sortable.create(toolsswaplist,{swap:!0,swapClass:"swapping-highlight",animation:250,store:{get:function(e){},set:function(e){var t=swapSortable.toArray(),o=0;t.forEach((function(e){swapTools[o++]=parseInt(e.substring(3))}))}}});var r,s=Sortable.create(historyitemscontainer,{swap:!1,swapClass:"swapping-highlight",animation:250,store:{get:function(){var e=localStorage.getItem("CmdHistory");if(void 0!==e){var t=JSON.parse(e);null!=t&&t.forEach((function(e){createHistoryItem(e)}))}},set:function(){for(var e="[ ",t=$("#historyitemscontainer"),o=0;o<t.children().length;o++){e+='"'+$(t.children()[o]).find("span").text()+'"',o<t.children().length-1&&(e+=",")}e+=" ]",localStorage.setItem("CmdHistory",e),showToast(historySavedLocally)}}});$("#accordion-settings input, #accordion-settings select").on("change",(function(){showChangesPending(!0);var e=$(this).prop("id");e.startsWith("Close-")&&async function(e,t){initDone&&e==getCurrentTool()&&await sendGcode('M205P"ServoClose"S'+t+"I99")}(parseInt(e.substring(6)),$(this).val());if("Device"==e&&(""==$(this).val()?$("#devname-label").text(noName):$("#devname-label").text($(this).val())),$(this).hasClass("form-check-input")){var t=$(this).prop("checked");switch(e){case"UsePurge":setCheckmark($("#card-purge"),t);break;case"SendStats":setCheckmark($("#card-sendstat"),t);break;case"Revolver-UseServo":t&&(hasDDE||$("#Revolver-TMC-Mode").val(0).trigger("change"));break;case"UseCutter":t?$("#lvc-cutter").removeClass("visually-hidden"):$("#lvc-cutter").addClass("visually-hidden");break;case"UseSplitter":setSplitterOption();break;case"Dlvl-1":case"Dlvl-2":case"Dlvl-4":case"Dlvl-8":case"Dlvl-16":case"Dlvl-32":case"Dlvl-64":case"Dlvl-128":return void changeDebugLevel();case"UseDuet":t?($(".hasDuet3D").removeClass("disabled"),$(".hasDuet3D").prop("disabled",!1)):($(".hasDuet3D").addClass("disabled"),$(".hasDuet3D").prop("disabled",!0))}checkForChange($(this))&&sendChange($(this)),"EmulPrusa"==$(this).prop("id")&&initDone&&($(this).is(":checked")?$("#btn-load-to-nozzle").removeClass("disabled"):$("#btn-load-to-nozzle").addClass("disabled"))}})),$("#accordion-settings input").on("focusout",(async function(){showChangesPending(!0),checkForChange($(this))&&(sendChange($(this)),"Revolver-ServoClose"==$(this).prop("id")&&$("#servo-closed-modal").modal("show"))})),$("#accordion-settings select").on("focusin",(async function(){initDone&&$(this).prop("id").endsWith("TMC-MS")&&0==(curMS=$(this).val())&&(curMS=1)})),$("#accordion-settings select").on("change",(async function(){if(initDone&&$(this).prop("id").endsWith("TMC-MS")){var e=$(this).prop("id");msItem=e.substring(0,e.length-("TMC-MS".length+1));var t=$(this).val(),o=$("#"+msItem+"-StepsMM").val();0==t&&(t=1),newStepsMM=parseInt(o/curMS*t),$("#request-steps-per-mm").html(reqStepsMM.replace("{ITEM}",msItem).replace("{VAL}",newStepsMM)),isNaN(newStepsMM)||$("#ms-changed-modal").modal("show")}showChangesPending(!0),checkForChange($(this))&&sendChange($(this))})),$("#console-container").on("hide.bs.collapse",(function(){$("#console-toggle-icon").toggleClass("down"),localStorage.setItem("Console","closed")})),$("#console-container").on("show.bs.collapse",(function(){$("#console-toggle-icon").toggleClass("down"),localStorage.setItem("Console","opened")})),$("#toast-placement").on("hide.bs.toast",(function(){hideElement($(this).prop("id")),$(this).find(".toast").each((function(){$(this).removeClass("d-flex")}))})),$("#toast-placement").on("show.bs.toast",(function(){showElement($(this).prop("id")),$(this).find(".toast").each((function(){$(this).addClass("d-flex")}))})),"closed"==localStorage.getItem("Console")&&$("#console-container").toggleClass("show"),$("#btn-selector-settings").trigger("click"),$("#btn-settings-general").trigger("click"),$("#connect, #connecting-message, #smuff-image").on("click",(function(){isStandalone?showConnectingMessage("slow",connectingDevice,openWebSock):"serial"in navigator?showConnectingMessage("slow",connectingSMuFF,connectSerial):(showError(noWebSerial),showConnectingMessage("slow",connectionFailed,null))})),$(".navbar-nav#main .nav-item").on("click",(async function(){var e=$(this).data("section");if(void 0!==e)if("#disconnect"==e)isStandalone||await disconnectSerial(),showConnect();else if($("li.nav-item").removeClass("activeSection"),$(this).addClass("activeSection"),$(".section:not("+e+")").hide(),$(e).fadeIn("slow"),"#sec-statusinfo"==e)0==tmcStatusInterval&&(tmcStatusInterval=setInterval((function(){refreshTMCStats()}),750));else if("#sec-dryer"==e)$("#LogSensor1").is(":checked")?(showElement("#btn-clear-data-1, #btn-clear-data-1-sec"),showElement("#ChartSensor1",!0,!1),hideElement("#info-sensor-1, #info-sensor-1-sec",!1,!1)):(hideElement("#btn-clear-data-1, #btn-clear-data-1-sec"),hideElement("#ChartSensor1",!0,!1),showElement("#info-sensor-1, #info-sensor-1-sec",!1,!1)),$("#LogSensor2").is(":checked")?(showElement("#btn-clear-data-2, #btn-clear-data-2-sec"),showElement("#ChartSensor2",!0,!1),hideElement("#info-sensor-2, #info-sensor-2-sec",!1,!1)):(hideElement("#btn-clear-data-2, #btn-clear-data-2-sec"),hideElement("#ChartSensor2",!0,!1),showElement("#info-sensor-2, #info-sensor-2-sec",!1,!1)),$("#btn-dryer-sec").text(isDrying?stopDrying:startDrying),isFan1Dynamic?showElement("#fan1-dynamic-sec",!1,!1):hideElement("#fan1-dynamic-sec",!1,!1);else if("#sec-live-control"==e)for(var t=0;t<getToolCount();t++)setFeedLoadState($("#lvc-in-splitter-"+t),feedLoadState[t]);else 0!=tmcStatusInterval&&(clearInterval(tmcStatusInterval),tmcStatusInterval=0)})),$("#console-text-container").on("scroll",(function(){autoScroll=!($(this)[0].scrollTop+$(this).height()<$(this)[0].scrollHeight-20)})),$(".remove-history-entry").on("click",(function(){$(this).parent().remove()})),$("#gcode").keypress((function(e){13==e.which&&$("#btn-send-gcode").trigger("click")})),$("#gcode").keydown((function(e){var t=$("#historyitemscontainer");38==e.which&&(e.preventDefault(),--historyIndex<0&&(historyIndex=t.children().length-1),setGcodeHistory()),40==e.which&&(e.preventDefault(),++historyIndex>=t.children().length&&(historyIndex=0),setGcodeHistory())})),$("body").on("keydown",(function(e){var t=e.keyCode||e.which;t>=112&&t<=115&&(e.preventDefault(),sendPFKey(t-32)),e.ctrlKey&&"s"===e.key&&(e.preventDefault(),$("#btn-save-settings").trigger("click")),e.ctrlKey&&"r"===e.key&&(e.preventDefault(),$("#btn-reload-settings").trigger("click"))})),$("#version-info, #release-notes").on("click",(function(){$("#recent-changes-modal").modal("show")})),$("#logo, #smuff").on("click",(function(){location.href="https://sites.google.com/view/the-smuff/"})),$("#btn-send-gcode").on("click",(async function(){var e=$("#gcode").val();null!=e&&e.length>0&&(historyIndex=-1,createHistoryItem(e),sendGcode(e,!0,!0),await getResponse()),$("#gcode").val("")})),$("#btn-clear-gcode").on("click",(function(){$("#console-text-container").empty()})),$("#btn-pf1").on("click",(function(){sendPFKey(80)})),$("#btn-pf2").on("click",(function(){sendPFKey(81)})),$("#btn-pf3").on("click",(function(){sendPFKey(82)})),$("#btn-pf4").on("click",(function(){sendPFKey(83)})),$("#btn-home").on("click",(function(){sendGcode("G28",!0,!0),moveCarrierG1=!1})),$("#btn-motors-off").on("click",(function(){sendGcode("M18",!0,!0)})),$("#btn-tool-maint").on("click",(function(){sendGcode("TM",!0,!0)})),$("#btn-wipe").on("click",(function(){sendGcode("G12",!0,!0)})),$("#btn-cut").on("click",(function(){sendGcode("G12C",!0,!0)})),$("#btn-load").on("click",(async function(){sendGcode("M700",!0,!0),showLoading(!1),await getResponse(),cancelInfo()})),$("#btn-unload").on("click",(async function(){$("#UseCutter").is(":checked")&&animateCutter(!1),sendGcode("M701",!0,!0),showUnloading(!1),await getResponse(),cancelInfo(),$("#UseCutter").is(":checked")&&animateCutterEnd()})),$("#btn-load-to-nozzle").on("click",(function(){sendGcode("M700N",!0,!0),showLoading(!1)})),$("#btn-load-to-splitter").on("click",(async function(){sendGcode("M700S",!0,!0),showLoading(!0)})),$("#btn-unload-from-splitter").on("click",(async function(){sendGcode("M701S",!0,!0),showUnloading(!0)})),$("#btn-reset").on("click",(function(){sendGcode("M999",!0,!0)})),$("#btn-view-script").on("click",(async function(){var e=$("#test-files option:selected").text();""!=e&&(sendGcode('M20L"test/'+e+'.gcode"'),await getResponse(),""!=responseBuffer&&($("#script-name").text(e),$("#script-content").val(responseBuffer),$("#view-script-modal").modal("show")))})),$("#btn-run-test").on("click",(async function(){var e;if("stopped"==$(this).data("state")){var t=$("#test-files option:selected").text();localStorage.setItem("runningScript",t),sendGcode('M98P"'+t+'"',!0,!1),await getResponse(),e=!0,testCancelled=0}else localStorage.setItem("runningScript",""),sendChar(""),e=!1,testCancelled=(new Date).getTime();showTestRunning(e)})),$("#btn-save-settings").on("click",(function(){showToast(savingSettings),saveConfig(),removeValFeedback()})),$("#btn-reload-settings").on("click",(function(){showToast(reloadingSettings),requestInit(),removeValFeedback()})),$("#btn-reset-swaps").on("click",(function(){var e=swapSortable.toArray();e.sort(),swapSortable.sort(e,!0),swapSortable.save()})),$("#btn-save-swaps").on("click",(async function(){for(var e="{ ",t=MAX_TOOLS,o=0;o<t;o++)e+="'T"+o+"':"+swapTools[o],o<t-1&&(e+=",");sendGcode('M504P"Swaps"S"'+(e+="}")+'"',!1,!1),await getResponse()&&showToast(toolSwapsSaved)})),$("#btn-save-history").on("click",(function(){s.save()})),$("#btn-copy-to-clipboard").on("click",(async function(){var e="";$('#console-text-container span:not([class^="fgc"],[class^="bgc"])').each((function(){""!=$(this).text()&&($(this).hasClass("data-sent")&&(e+="[--- "),e+=$(this).text().replaceAll("\n",""),$(this).hasClass("data-sent")?e+=" ---]\n":e+="\n")})),await navigator.clipboard.writeText(e),showToast(copiedToClipboard)})),$("#btn-wizard").on("click",(function(){showWizard()})),$("#btn-OTA").on("click",(function(){hideElement("#upload-progress"),$("#esp-firmware-upload-modal").modal("show")})),$("#firmware-file").on("change",(function(e){1==e.target.files.length?($("#btn-upload-firmware").removeClass("disabled"),$("#btn-upload-firmware").prop("disabled",!1),r=e.target.files[0]):($("#btn-upload-firmware").addClass("disabled"),$("#btn-upload-firmware").prop("disabled",!0),r=null)})),$("#btn-upload-firmware").on("click",(function(){if(console.log(r),null!=r){var e=new FileReader;e.onerror=function(e){switch(e.target.error.code){case e.target.error.NOT_FOUND_ERR:showToast(fileNotFound);break;case e.target.error.NOT_READABLE_ERR:ahowToast(fileNotReadable);break;case e.target.error.ABORT_ERR:break;default:showToast(fileReadError)}fwBuffer=null},e.onprogress=async function(e){e.loaded==e.total&&(await sendUploadRequest("firmware.tmp",e.total),console.log("file loaded completely"))},e.onabort=function(e){showToast(uploadAborted),fwBuffer=null},e.onloadstart=function(e){console.log(e.srcElement.readyState)},e.onload=async function(t){console.log(t.currentTarget.result),t.currentTarget.readyState==e.DONE&&($("#firmware-upload-modal").modal("show"),fwBuffer=new Uint8Array(t.currentTarget.result),setTimeout((function(){sendBuffer(fwBuffer)}),500))},e.readAsArrayBuffer(r)}})),$("#btn-modal-ok").on("click",(async function(){$("#restart-modal").modal("hide"),sendGcode("M999"),await getResponse()})),$("#btn-modal-wipe-ok").on("click",(async function(){$("#wipe-sequence-modal").modal("hide");var e="S"+$("#wipe-S").val()+"I"+$("#wipe-I").val()+"J"+$("#wipe-J").val()+"P"+$("#wipe-P").val()+"R"+$("#wipe-R").val();$("#WipeSeq").val(e),sendChange($("#WipeSeq"))})),$("#btn-servo-ok").on("click",(function(){$("#servo-closed-modal").modal("hide");var e=$("#Revolver-ServoClose").val();$('input[id^="Close-"]').each((async function(){$(this).val(e).trigger("focusout"),await getResponse()}))})),$("#btn-ms-changed-ok").on("click",(function(){$("#ms-changed-modal").modal("hide"),$('input[id="'+msItem+'-StepsMM"]').each((async function(){$(this).val(newStepsMM).trigger("focusout"),await getResponse()}))})),$("#btn-cancel-upload").on("click",(function(){uploadCancelled=!0})),$("#btn-usrmsg-modal-ok").on("click",(async function(){$("#usrmsg-modal").modal("hide")})),$("#btn-usrdlg-modal-1").on("click",(async function(){$("#usrdlg-modal").modal("hide"),gotDlgButton=!0,sendDialogResult(lastDlgId,1)})),$("#btn-usrdlg-modal-2").on("click",(async function(){$("#usrdlg-modal").modal("hide"),gotDlgButton=!0,sendDialogResult(lastDlgId,2)})),$("#btn-usrdlg-modal-3").on("click",(async function(){$("#usrdlg-modal").modal("hide"),gotDlgButton=!0,sendDialogResult(lastDlgId,3)})),$("#usrdlg-modal").on("hidden.bs.modal",(function(){gotDlgButton||sendDialogResult(lastDlgId,0)})),$("#file-input-firmware").on("input",(function(e){setDisabled(!1,"#btn-upload-esp-firmware"),e.target.files.length>0&&("firmware.bin"===e.target.files[0].name||"littlefs.bin"===e.target.files[0].name||"smuff.bin"===e.target.files[0].name)&&$("#btn-upload-esp-firmware").prop("disabled","").removeClass("disabled")})),$("#btn-upload-esp-firmware").on("click",(function(){showElement("#upload-progress",!1,!1),setDisabled(!0,"#btn-upload-esp-firmware"),$("#progress-esp-upload .progress-bar").css("width","0%").text("0%"),(new Upload).doUpload($("#upload-form")[0],"uploadBinary",(function(e){var t=0,o=e.loaded||e.position,a=e.total;e.lengthComputable&&(t=Math.ceil(o/a*100)),$("#progress-esp-upload .progress-bar").css("width",t+"%").text(t+"%")}),(function(e){console.log(uploadSuccess),$("#file-input-firmware")[0].value="",$("#uploading-label").text(uploadSuccess),setTimeout((function(){hideElement("#upload-progress",!1,!1),$("#esp-firmware-upload-modal").modal("hide"),showConnect(),window.location.reload(!0)}),8e3)}),(function(e){console.log(uploadFailed),$("#file-input-firmware")[0].value="",$("#uploading-label").text(uploadFailed)}))})),$("#card-relay").on("click",(async function(){if(hasSharedStepper&&!isTestRunning){var e="I"==$(this).find("span#state").data("state")?"E":"I";$(this).find("span#state").data("state",e),setRelayState(e),sendGcode("M17"+e,!0,!1),await getResponse()}})),$("#card-lid").on("click",(async function(){if(!isTestRunning){var e="0"==$(this).find("i").data("state")?"1":"0";hasLidState||setLidIcon(e),sendGcode("M280R"+e,!0,!1),await getResponse()}})),$("#card-purge").on("click",(async function(){if(!hasExtCtrl&&!isTestRunning){var e="0"==$(this).find("i").data("state")?"1":"0";setCheckmark(this,e),sendGcode('M205P"UsePurge"S'+e,!0,!1),await getResponse(),sendGcode("M503S1W",!1,!1),await getResponse()}})),$("#card-sendstat").on("click",(async function(){if(!isTestRunning){var e="0"==$(this).find("i").data("state")?"1":"0";setCheckmark(this,e),sendGcode('M205P"SendStats"S'+e,!0,!1),await getResponse(),sendGcode("M503S1W",!1,!1),await getResponse()}})),$("#tmc-status").on("click",(function(){$('.nav-item[data-section="#sec-statusinfo"]').trigger("click")})),$("#changes-pending").on("click",(function(){$('.nav-item[data-section="#sec-settings"]').trigger("click")})),$("#tool-selection").on("change",(async function(){if(moveCarrierG1=!1,$("#selector-pwr-off").addClass("hidden"),-1==$(this).val())sendGcode("G28X",!0,!1),moveCarrier(0),await getResponse();else{var e=parseInt($(this).val().substring(1));sendGcode($(this).val(),!0,!1),moveCarrier(e),await getResponse()}})),$("[id^=history-item-]").on("click",(function(){$("#gcode").focus(),$("#gcode").val($(this).find("span").text())})),$("#WipeSeq").on("focus, click",(function(){var e=$(this).val().matchAll(/([a-zA-Z]\d{1,3})/g);for(const t of e)console.log(t[0]),$("#wipe-"+t[0].toUpperCase()[0]).val(t[0].substring(1));$("#wipe-sequence-modal").modal("show")})),$("#Revolver-ServoClose").on("change",(async function(){initDone&&(sendGcode('M205P"ServoClose"S'+$(this).val()+"I99"),await getResponse())})),$("#Revolver-ServoOpen").on("change",(async function(){initDone&&(sendGcode('M205P"ServoOpen"S'+$(this).val()+"I99"),await getResponse())}))}));var tmcStatusBusy=!1;async function refreshTMCStats(){!tmcStatusBusy&&initDone&&(tmcStatusBusy=!0,$("#tmc-stat-0").hasClass("hidden")||(sendGcode("M122W0"),await getResponse()),$("#tmc-stat-1").hasClass("hidden")||(sendGcode("M122W1"),await getResponse()),$("#tmc-stat-2").hasClass("hidden")||(sendGcode("M122W2"),await getResponse()),$("#tmc-stat-3").hasClass("hidden")||(sendGcode("M122W3"),await getResponse()),tmcStatusBusy=!1)}function showTestRunning(e){if(!(1==e&&testCancelled>0&&(new Date).getTime()-testCancelled<4e3)){var t=$("#btn-run-test"),o=$("#test-status"),a=localStorage.getItem("runningScript");e?"running"!=t.data("state")&&(t.data("state","running"),t.find("i").removeClass("fa-play"),t.find("i").addClass("fa-stop"),o.removeClass("hidden"),o.html('Test <i>"'+a+'"</i> is running&hellip;'),isTestRunning=!0,$('.nav-item[data-section="#sec-dashboard"]').addClass("hidden"),$('.nav-item[data-section="#sec-live-control"]').addClass("hidden"),$('.nav-item[data-section="#sec-settings"]').addClass("hidden"),$('.nav-item[data-section="#sec-swaptools"]').addClass("hidden"),$('.nav-item[data-section="#sec-statusinfo"]').addClass("hidden"),setDisabled(!0,".sec-status"),$("#sec-status").hide("slow")):"stopped"!=t.data("state")&&(t.data("state","stopped"),t.find("i").removeClass("fa-stop"),t.find("i").addClass("fa-play"),o.addClass("hidden"),o.text(o.text().replace(a,"{TEST}")),isTestRunning=!1,$('.nav-item[data-section="#sec-dashboard"]').removeClass("hidden"),$('.nav-item[data-section="#sec-live-control"]').removeClass("hidden"),$('.nav-item[data-section="#sec-settings"]').removeClass("hidden"),$('.nav-item[data-section="#sec-swaptools"]').removeClass("hidden"),hasTmc&&$('.nav-item[data-section="#sec-statusinfo"]').removeClass("hidden"),setDisabled(!1,".sec-status"),$("#sec-status").show("slow"))}}function setCheckmark(e,t){var o=$(e).find("i");o.data("state",t),"send-stat"!=o.prop("id")?(o.removeClass("fa-check-circle fa-times-circle icon-checked icon-unchecked"),o.addClass("0"==t?"fa-times-circle icon-unchecked":"fa-check-circle icon-checked")):(o.removeClass("fa-repeat fa-times-circle fa-spin"),o.addClass("0"==t?"fa-times-circle":"fa-repeat fa-spin"))}function hideConnect(){$("#sec-start").fadeOut("slow").promise().done((function(){$("#content").css("padding-top",hasDryer?"230px":"200px"),$("#content").scrollTop(0),$("#sec-dashboard, #top-info").fadeIn("fast"),$('li.nav-item[data-section="#sec-dashboard"]').addClass("activeSection"),$('li.nav-item[data-section!="#sec-dashboard"]').removeClass("activeSection")})),$("#nav-container").removeClass("hidden"),tmcNotUsed=0,hideStatusInfoNav(),$("#btn-wizard").css("display","block");var e=localStorage.getItem("LastWizardDevice");localStorage.getItem("ShowWizard")!==never&&(localStorage.getItem("ShowWizard")==no&&e==$("#devname-label").text()||showWizard())}function showConnect(){$("#sec-dashboard, #sec-settings, #sec-swaptools, #sec-statusinfo, #sec-boardinfo, #sec-testrun, #sec-live-control, #top-info, #sec-dryer").fadeOut("fast").promise().done((function(){$("#content").css("padding-top","70px"),$("#sec-start").fadeIn("fast"),showConnectingMessage("slow",disconnected,null),setTimeout((function(){showConnectingMessage("slow",clickToConnect,null)}),2e3)})),$("#nav-container").addClass("hidden"),$("#btn-wizard").css("display","none")}async function sendChange(e){if(initDone){var t=buildM205Command(e);if(""!=t){e.removeClass("val-failed"),sendGcode(t);var o=await getResponse();e.addClass(o?"val-changed":"val-failed"),o||showToast(saveSettingFailed)}}}function setValue(e,t){try{if(void 0===e)return;for(var o of Object.keys(e)){var a,n=!1;t.indexOf("${key}")>-1?(a=t.replace("${key}",o),n=!0):a=t;var i=$("#"+a+(n?"":o));if(void 0!==i&&null!=i){if("checkbox"==i.prop("type")){var r,s;if("boolean"==typeof e[o])switch(r=e[o],e[o]){case!0:s=yes;break;case!1:s=no}else switch(e[o]){case 1:r=!0,s=high;break;case 0:r=!1,s=low;break;case"PWM":r=!1,s=pwm;break;case"OUTPUT":r=!0,s=output}i.prop("checked",r),i.attr("data-bs-original-title",s)}else if("color"==i.prop("type"))i.val("#"+e[o]);else{i.val(e[o]);var l=0;switch(o){case"LBtnDown":l=1;break;case"LBtnHold":l=2;break;case"RBtnDown":l=3;break;case"RBtnHold":l=4}l>0&&""!=e[o]&&$("#btn-pf"+l).text(pfButton+l+" ( "+e[o]+" )")}i.trigger("change")}else console.log("Control #"+o+" not found!");0}}catch(e){console.log("Failed to set value",e)}}function changeDebugLevel(){var e=0;$("#Dlvl-1").is(":checked")&&(e|=1),$("#Dlvl-2").is(":checked")&&(e|=2),$("#Dlvl-4").is(":checked")&&(e|=4),$("#Dlvl-8").is(":checked")&&(e|=8),$("#Dlvl-16").is(":checked")&&(e|=16),$("#Dlvl-32").is(":checked")&&(e|=32),$("#Dlvl-64").is(":checked")&&(e|=64),$("#Dlvl-128").is(":checked")&&(e|=128),console.log("Debug-Level: "+e),sendGcode("M111S"+e,!1,!1)}function setDebugLevel(e){var t=e.Level;$("#Dlvl-1").prop("checked",1&t),$("#Dlvl-2").prop("checked",2&t),$("#Dlvl-4").prop("checked",4&t),$("#Dlvl-8").prop("checked",8&t),$("#Dlvl-16").prop("checked",16&t),$("#Dlvl-32").prop("checked",32&t),$("#Dlvl-64").prop("checked",64&t),$("#Dlvl-128").prop("checked",128&t)}function setTMCstats(e){var t=e.TMCStatus.Axis;if(1==e.TMCStatus.InUse)for(var o of($("#tmc-stat-"+t).removeClass("hidden"),Object.keys(e.TMCStatus))){var a=$("#tmc-stat-"+t+"-"+o);"Version"==o&&(parseInt(e.TMCStatus[o])<1?versionMismatch[t]++:versionMismatch[t]>0&&versionMismatch[t]--),versionMismatch[t]>10&&(showToast(tmcVersionMismatch),$("#tmc-status").removeClass("hidden")),a.text(e.TMCStatus[o]),void 0!==a.parent().data("alert")&&("No"!=a.text()?(a.addClass("tmc-warning"),$("#tmc-status").removeClass("hidden")):(a.removeClass("tmc-warning"),$("#tmc-status").addClass("hidden")))}else $("#tmc-stat-"+t).addClass("hidden"),tmcNotUsed++;4==tmcNotUsed&&(hasTmc=!1,hideStatusInfoNav())}function setSettings(e,t){var o;try{if(o=JSON.parse(e),"Debug"==t&&(localStorage.setItem("DBG",e),setDebugLevel(o)),"TMC"==t&&(localStorage.setItem("TMC",e),setTMCstats(o)),"Basic"==t&&(localStorage.setItem("M503S1",e),setValue(o,""),setValue(o.Baudrates,"baudrate-")),"Steppers"==t&&(localStorage.setItem("M503S2",e),setValue(o.Selector,"Selector-"),setValue(o.Revolver,"Revolver-"),setValue(o.Feeder,"Feeder-")),"TMC Driver"==t&&(localStorage.setItem("M503S3",e),setValue(o.Selector,"Selector-TMC-"),setValue(o.Revolver,"Revolver-TMC-"),setValue(o.Feeder,"Feeder-TMC-")),"Servo mapping"==t&&(localStorage.setItem("M503S4",e),!hasV6S)){for(var a=getToolCount(),n=0;n<a;n++)setValue(o["T"+n],"${key}-"+n);setValue(o.Lid,"${key}-lid"),setValue(o.Wiper,"${key}-wiper"),setValue(o.Cutter,"${key}-cutter"),setValue(o.Spare1,"${key}-spare1"),setValue(o.Spare2,"${key}-spare2"),setValue(o.Relay,"${key}-relay"),setValue(o.Out6,"${key}-user1"),setValue(o.Out7,"${key}-user2")}if("Materials"==t){localStorage.setItem("M503S5",e);a=getToolCount();toolColors=new Array(a);for(n=0;n<a;n++)setValue(o["T"+n],"materials-tool-"+n+' [id="${key}-'+n+'"]'),toolColors[n]=$("#materials-tool-"+n+' [id="Color-'+n+'"]').val()}if("Tool swaps"==t){localStorage.setItem("M503S6",e);for(n=0;n<MAX_TOOLS;n++)swapTools[n]=o["T"+n];setupSwaps()}if("Revolver mapping"==t){localStorage.setItem("M503S7",e);for(n=0;n<MAX_TOOLS;n++)stepperMappings[n]=o["T"+n];hasV6S&&setupStepperMappings()}if("Dryer"==t&&(localStorage.setItem("M503S9",e),setValue(o,""),setValue(o.HumidityLevels,"HumidityLevel-"),setValue(o.DynFanSpeeds,"DynFanSpeed-")),"Feed State"==t){for(n=0;n<MAX_TOOLS;n++)feedLoadState[n]=0,void 0!==o["T"+n]&&(feedLoadState[n]=o["T"+n]);setTimeout((function(){for(var e=0;e<getToolCount();e++)setFeedLoadState($("#lvc-in-splitter-"+e),feedLoadState[e])}),750)}t=""}catch(o){return seenParserError=!0,console.log(o),msg='In Config type: "'+t+'" Data: ',console.log(msg),console.log(e),addReceivedGcode('<span class="bgc41">Critical Parser error!</span><br/><span class="fgc36">'+msg+'<br/></span><span class="fgc34">'+e+"<br/></span>"),void showToast(failedReadSettings)}}function addTestFiles(e){try{var t=JSON.parse(e);$("#test-files").empty(),null!=t&&t.forEach((function(e){var t=e.indexOf(".gcode");if(-1!=t){var o=e.substring(0,t);$("#test-files").append(new Option(o,""))}}))}catch(e){console.log(e),showToast(failedReadingTestFiles)}}function setRelayState(e){var t=e.substring(0,1),o=$("#card-relay").find("span#state");o.data("state",t),o.text(t)}function setFWInfo(e){hasTmc=!1,hasV6S=!1,hasDDE=!1,hasMultiservo=!1,hasDryer=!1;try{var t=e.split(":"),o=t[3].replace(" DATE","").trim();$("#version-label").text(t[2].replace(" ELECTRONICS","")),$("#electronics-label").text(o),$("#mode-label").text(t[5].replace(" OPTIONS","")),$("#acc-servo-pinmaps").addClass("d-none");try{if(t.length>5){console.log("Options: "+t[6]),$("#electronics-label").prop("title",t[6].replaceAll("|","; ")),boardOptions=t[6].split("|"),hasNeoPixels=!1,setDisabled(!0,".hasNeopixels"),setDisabled(!0,".hasBacklight"),setDisabled(!0,".hasTMC"),setDisabled(!0,".hasV6S"),setDisabled(!1,".has1stEndstop"),setDisabled(!1,".hasNotV6S"),setDisabled(!1,".hasPurge"),setDisabled(!0,".hasDDE"),setDisabled(!0,".hasSpoolmotors"),$("#acc-display").removeClass("hidden"),$("#acc-servo-pinmaps").addClass("d-none");for(var a=0;a<boardOptions.length;a++)boardOptions[a]=boardOptions[a].trim(),addSentGcode(boardOptions[a]),"MULTISERVO"==boardOptions[a]&&(hasMultiservo=!0,$("#acc-servo-pinmaps").removeClass("d-none")),"SPOOLMOTORS"==boardOptions[a]&&(hasSpoolmotors=!0,setDisabled(!1,".hasSpoolmotors")),"TMC"==boardOptions[a]&&(hasTmc=!0,setDisabled(!1,".hasTMC")),"V6S"==boardOptions[a]&&(hasV6S=!0,setDisabled(!1,".hasV6S"),setDisabled(!0,".hasNotV6S")),"DDE"==boardOptions[a]&&(hasDDE=!0,setDisabled(!1,".hasDDE"),setDisabled(!0,".hasNotDDE")),"NEOPIXELS"==boardOptions[a]&&(hasNeoPixels=!0,setDisabled(!1,".hasNeopixels")),"ESTOP-MUX"==boardOptions[a]&&(hasEStopMux=!0,setDisabled(!1,".has1stEndstop")),boardOptions[a].startsWith("MINIPANEL V2")&&setDisabled(!1,".hasBacklight"),"SERIAL-TFT"==boardOptions[a]&&(hasSerialDisplay=!0,$("#acc-display").addClass("hidden")),"DRYER"==boardOptions[a]&&(hasDryer=!0);if(hasDryer)showElement("#row-quickinfo2"),showElement("#timeout-div"),showElement("#btn-dryer"),showElement("#nav-item-dryer"),$("#acc-dryer").removeClass("d-none"),null==localStorage.getItem("DryerProfiles")&&createDefaultDryerProfiles();else hideElement("#row-quickinfo2"),hideElement("#timeout-div"),hideElement("#btn-dryer"),hideElement("#nav-item-dryer"),$("#acc-dryer").addClass("d-none");hasV6S||hasDDE?(showElement("#tmc-mode-revolver"),showElement("#tmc-section-revolver"),hasDDE&&($("#btn-revolver-settings").text(lidDDE),$(".hasDDE.servoOnly").removeClass("hidden")),hasV6S&&($("#btn-revolver-settings").text(lidV6S),$("#btn-servo-mappings").text(stepperMaps),$(".hasV6S.servoOnly").removeClass("hidden"))):(hideElement("#tmc-mode-revolver"),hideElement("#tmc-section-revolver"),$("#btn-revolver-settings").text(lidOnly),$("#btn-servo-mappings").text(servoMaps),hideElement(".hasV6S.hasDDE.servoOnly"))}}catch(e){console.log(e)}try{o=o.replaceAll(" ","_");var n=sitePrefix+"/assets/img/";isStandalone&&(n=githubPrefix+"/assets/img/"),$("#pins-image").prop("src",n+o+".png"),$("#dryer-image").prop("src",n+o+"_DryerWiring.png"),hasDDE?$("#wiring-image").prop("src",n+o+"_Wiring_DDE.png"):$("#wiring-image").prop("src",n+o+"_Wiring.png"),hasDryer?showElement("#slide-dryer-image",!1,!1):hideElement("#slide-dryer-image",!1,!1)}catch(e){hideBoardInfoNav()}hideStatusInfoNav(),(curFWVersion=parseFloat($("#version-label").text().trim().substring(1)))<2.26&&($("#version-label").addClass("version-warning"),$("#version-label").prop("title",fwWarning),showToast(fwWarning)),curFWVersion<lastFWVersion&&($("#latest-version-info").text(lastFWVersion),setTimeout((function(){toastVersion.show()}),3e3))}catch(e){console.log(e)}}function hideStatusInfoNav(){hasTmc||hideElement('.nav-item[data-section="#sec-statusinfo"] .nav-link')}function hideBoardInfoNav(){hasTmc||hideElement('.nav-item[data-section="#sec-boardinfo"] .nav-link')}function setStatus(e){var t=e.substring(14),o=0;statusTime++,hasLidState=!1;var a=t.matchAll(/([A-Z]{1,3}[\d|:]+).(\+?\w+|-?\d+|\-\w+)+/g);for(const e of a){var n="on"==e[2];switch(e[1]){case"T:":$("#tool-selection").val(e[2]),o=e[2];break;case"S:":setCheckmark($("#card-selector"),n),setSelectorLed(n);break;case"R:":setCheckmark($("#card-revolver"),n);break;case"F:":setCheckmark($("#card-feed1"),n),isFeederLoaded=n,setFeederLed(n);break;case"F2:":setCheckmark($("#card-feed2"),n);break;case"SD:":n?showSDWarning():cancelSDWarning();break;case"SC:":n&&setTimeout((function(){$("#btn-reload-settings").trigger("click")}),2e3);break;case"LID:":setLidIcon(n),hasLidState=!0;break;case"I:":smuffIsIdle=n;break;case"SPL:":-1!=(o=getCurrentTool())&&(feedLoadState[o]=e[2]);break;case"RLY:":setRelayState(e[2]);break;case"TMP1:":temperature1=parseFloat(e[2])/10,$("#temp1-label, #temp1-label-sec").text(temperature1.toFixed(1));break;case"TMP2:":temperature2=parseFloat(e[2])/10,$("#temp2-label, #temp2-label-sec").text(temperature2.toFixed(1));break;case"HUM1:":humidity1=parseFloat(e[2])/10,$("#humidity1-label, #humidity1-label-sec").text(humidity1.toFixed(1));break;case"HUM2:":humidity2=parseFloat(e[2])/10,$("#humidity2-label, #humidity2-label-sec").text(humidity2.toFixed(1));break;case"HT1:":heater1=parseFloat(e[2])/10,$("#heater1-label, #heater1-label-sec").text(heater1.toFixed(1));break;case"HTT1:":var i=parseFloat(e[2])/10;heater1Target!=i&&(heater1Target=i,$("#heater1-target-label, #heater1-target-label-sec").text(heater1Target.toFixed(1))),isDrying=heater1Target>0,isHeaterSet=heater1>=heater1Target-1&&heater1<heater1Target+3;break;case"TIM:":if((heaterTimeout=parseInt(e[2]))>0){var r=new Date(1e3*heaterTimeout).toISOString().substring(11,19);$("#timeout-label, #timeout-label-sec").text(r),showElement("#timeout-div")}else $("#timeout-label-sec").text("--:--:--"),hideElement("#timeout-div");break;case"HON:":(heaterOn=n)?($("#heating-div").addClass("heating"),showElement("#heating-icon")):($("#heating-div").removeClass("heating"),hideElement("#heating-icon"));break;case"DF1:":dryerFan1Speed=parseInt(e[2]),$("#fan1-label, #fan1-label-sec").text(dryerFan1Speed),0==dryerFan1Speed?($("#dryer-fan-icon").hasClass("fa-spin")||$("#dryer-fan-icon").hasClass("fa-pulse"))&&$("#dryer-fan-icon").removeClass("fa-spin").removeClass("fa-pulse"):dryerFan1Speed<50?$("#dryer-fan-icon").hasClass("fa-spin")&&!$("#dryer-fan-icon").hasClass("fa-pulse")||$("#dryer-fan-icon").addClass("fa-spin").removeClass("fa-pulse"):dryerFan1Speed>=50&&(!$("#dryer-fan-icon").hasClass("fa-spin")&&$("#dryer-fan-icon").hasClass("fa-pulse")||$("#dryer-fan-icon").removeClass("fa-spin").addClass("fa-pulse"));break;case"DF2:":dryerFan2Speed=parseInt(e[2]),$("#fan2-label, #fan2-label-sec").text(dryerFan2Speed);break;case"HW:":n?(showHeaterWarning(),$("#heater1-label, #heater1-label-sec").addClass("tmc-warning"),$("#heater1-icon").addClass("tmc-warning")):($("#heater1-label, heater1-label-sec").removeClass("tmc-warning"),$("#heater1-icon").removeClass("tmc-warning"),cancelHeaterWarning())}}if(isDrying){if($("#heater-column").addClass("drying"),$("#heater-status-sec").text(isHeaterSet?dryerDrying:dryerHeating),isStandalone){cmdCoolSent=!1,cmdClearSent=!1;var s=Date.now();heaterOn&&!cmdHeatingSent&&s-lastWiCmd>1e3&&(sendWebSock(NeoPixelCmd+NeoPixelCmdHeating),cmdHeatingSent=!0,cmdHeatSent=!1,lastWiCmd=Date.now()),!heaterOn&&!cmdHeatSent&&s-lastWiCmd>1e3&&(sendWebSock(NeoPixelCmd+NeoPixelCmdHeat),cmdHeatingSent=!1,cmdHeatSent=!0,lastWiCmd=Date.now())}}else $("#heater-column").removeClass("drying"),$("#heater-status-sec").text(heater1<45?dryerIdle:dryerCooling),$("#btn-dryer-sec").text()!==startDrying&&$("#btn-dryer-sec").text(startDrying),isStandalone&&(cmdHeatingSent=!1,cmdHeatSent=!1,heater1<45&&!cmdClearSent&&(sendWebSock(NeoPixelCmd+NeoPixelCmdClear),cmdClearSent=!0),heater1>=45&&!cmdCoolSent&&(sendWebSock(NeoPixelCmd+NeoPixelCmdCool),cmdCoolSent=!0,cmdClearSent=!1));0==loggingStart&&(loggingStart=new Date),$("#LogSensor1").is(":checked")&&(statusTime%5==0&&logSensor(1,temperature1,humidity1,heater1,heater1Target),lastHumidity1=humidity1,lastTemperature1=temperature1,lastHeater1=Math.ceil(heater1)),$("#LogSensor2").is(":checked")&&(statusTime%5==0&&logSensor(2,temperature2,humidity2),lastHumidity2=humidity2,lastTemperature2=temperature2),0==temperature1&&0==humidity1?hideElement("#sensor1-column"):showElement("#sensor1-column"),0==temperature2&&0==humidity2?hideElement("#sensor2-column"):showElement("#sensor2-column"),0==heater1?hideElement("#heater-column"):showElement("#heater-column"),0==temperature1&&0==temperature2&&0==humidity1&&0==humidity2&&0==heater1&&hideElement("#row-quickinfo2"),o=getCurrentTool(),moveCarrierG1||(smuffIsIdle||($('[id^="lvc-led-"]').each((function(){$(this).prop("id").endsWith(o)||setToolLed($(this),!1)})),-1!=o&&setToolLed($("#lvc-led-"+o),!0)),moveCarrier(-1==o?0:o)),setIdleAnimation(smuffIsIdle)}function hideElement(e,t=!0,o=!0){$(e).addClass("hidden"),t&&$(e).removeClass("d-flex"),o&&$(e).removeClass("d-inline")}function showElement(e,t=!0,o=!0){$(e).removeClass("hidden"),t&&$(e).addClass("d-flex"),o&&$(e).addClass("d-inline")}function setFeedLoadState(e,t){var o=e.width()*parseInt(t);void 0!==e&&e.scrollLeft()!=o&&e.animate({scrollLeft:o+"px"},600);var a=e.parent().find('img[id^="lvc-fitting-"]');2==t?a.attr("data-bs-original-title",ttpUnloadFromNozzle).tooltip("update"):1==t?a.attr("data-bs-original-title",ttpLoadToNozzle).tooltip("update"):16==t?a.attr("data-bs-original-title",ttpUnloadFromSelector).tooltip("update"):32==t?a.attr("data-bs-original-title",ttpUnloadFromNozzle).tooltip("update"):64==t?a.attr("data-bs-original-title",ttpUnloadFromDDE).tooltip("update"):a.attr("data-bs-original-title",ttpLoadToSplitter).tooltip("update")}function moveCarrier(e){var t=$("#lvc-slot-template").width(),o=$("#lvc-carrier").width();$("#lvc-carrier").css("right",o+e*t+"px")}function setToolLed(e,t,o,a){if(t){var n=$("#ToolColor").find(":selected").text();void 0!==o&&(n=o),$(e).css("opacity",1),$(e).css("background-color",n).fadeIn(smuffIsIdle?"fast":"slow")}else{if(hasNeoPixels)var i=0;void 0!==a?(i=parseFloat($(e).css("opacity"))-a,$(e).css("opacity",i<0?0:i)):$(e).css("opacity",0).fadeOut("fast")}}var idleAnimTimer=0;function setIdleAnimation(e){if(""!=$("#AnimBPM").val()&&hasNeoPixels){var t=getToolCount();if(-1!=t){var o=60/$("#AnimBPM").val()*1e3/t/3,a=getCurrentTool(),n=0,i=!0,r=!1;e?$("#IdleAnim").is(":checked")&&0==idleAnimTimer&&(idleAnimTimer=setInterval((async function(){if(a==t-1&&i?(i=!1,r=!0):0!=a||i||(i=!0,r=!0),$("#lvc-led-"+a).css("opacity")<=.15&&(r=!1),r||(i?a++:a--),$('[id^="lvc-led-"').each((function(){setToolLed($(this),!1,null,.2)})),!r){var e="hsl("+n+",80%,50%);";setToolLed($("#lvc-led-"+a),!0,e),(n+=5)>360&&(n=0)}}),o)):(0!=idleAnimTimer&&clearInterval(idleAnimTimer),idleAnimTimer=0)}}}function setTestResults(e){try{var t=JSON.parse(e.substring(15));$("#tst-elapsed").text(t.Elapsed),$("#tst-loopcnt").text(t.Loops),$("#tst-cmdcnt").text(t.Cmds),$("#tst-changes").text(t.ToolChanges),$("#tst-feederr").text(t.FeederErrors),$("#tst-stallselector").text(t.SelectorStalls),$("#tst-stallfeeder").text(t.FeederStalls);for(var o=t.FeedsOk.split("|"),a=t.FeedsMissed.split("|"),n=0;n<o.length;n++){var i=o[n].trim(),r=a[n].trim();i.length>0&&$("#tst-ok-"+n).text(i),r.length>0&&$("#tst-fail-"+n).text(r)}}catch(e){console.log(e)}}function showToast(e){$("#toast-message").html(e),toastMain.show()}function initWizard(){$("#wizard-device").val($("#Device").val()),$("#wizard-tools").val($("#Tools").val()),$("#wizard-bowden-len").val($("#BowdenLen").val()),$("#wizard-is-marlin").prop("checked",!1),$("#wizard-is-pmmu").prop("checked",$("#EmulPrusa").is(":checked")),$("#wizard-is-duet").prop("checked",$("#UseDuet").is(":checked")),$("#wizard-has-shared-stepper").prop("checked",$("#Feeder-SharedStepper").is(":checked")),$("#wizard-has-cutter").prop("checked",$("#UseCutter").is(":checked")),$("#wizard-selector-res09").prop("checked",!1),$("#wizard-feeder-res09").prop("checked",!1);var e=$("#electronics-label").text().trim();(e.endsWith("E3 V1.2")||e.endsWith("E3 V2.0")||e.endsWith("E3 V3.0"))&&$("#wizard-has-tmc2209").prop("checked",!0),"SMuFF"==$("#mode-label").text().trim()&&$("#wizard-is-marlin").prop("checked",!0),$("#wizard-is-marlin").trigger("change"),$("#wizard-is-pmmu").trigger("change"),$("#wizard-is-duet").trigger("change"),$("#wizard-has-shared-stepper").trigger("change"),$("#wizard-has-cutter").trigger("change"),$("#wizard-has-tmc2209").trigger("change"),$("#wizard-selector-res09").trigger("change"),$("#wizard-feeder-res09").trigger("change"),hasDDE?($("#wizard-dde-res09").trigger("change"),$("#wizard-dde-row").removeClass("hidden")):hideElement("#wizard-dde-row")}async function storeWizard(){var e=$("#wizard-device").val(),t=parseInt($("#wizard-tools").val()),o=parseFloat($("#wizard-bowden-len").val()),a=$("#wizard-is-pmmu").prop("checked"),n=$("#wizard-is-duet").prop("checked"),i=$("#wizard-has-shared-stepper").prop("checked"),r=$("#wizard-has-cutter").prop("checked"),s=$("#wizard-has-tmc2209").prop("checked"),l=$("#wizard-selector-res09").prop("checked"),c=$("#wizard-feeder-res09").prop("checked"),d=$("#wizard-dde-res09").prop("checked");setWizardOption("#Device",e),setWizardOption("#Tools",t),setWizardOption("#BowdenLen",o),setWizardBoolOption("#EmulPrusa",a),setWizardBoolOption("#Feeder-SharedStepper",i),setWizardBoolOption("#UseDuet",n),setWizardBoolOption("#UseCutter",r),s&&(setWizardListOption("#Selector-TMC-Mode",1),setWizardListOption("#Feeder-TMC-Mode",1),hasDDE&&setWizardListOption("#Revolver-TMC-Mode",1)),setWizardOption("#Selector-StepsMM",l?160:80),setWizardOption("#Feeder-StepsMM",c?820:410),hasDDE&&setWizardOption("#Revolver-StepsMM",d?820:410),$("#btn-save-settings").trigger("click")}function setWizardBoolOption(e,t){$(e).prop("checked")!=t&&$(e).trigger("click")}function setWizardOption(e,t){$(e).val()!=t&&$(e).val(t).trigger("focusout")}function setWizardListOption(e,t){$(e).val()!=t&&$(e).val(t).trigger("change")}function showWizard(){initWizard(),$("#wizard-modal").modal("show")}function hideWizard(){setTimeout((function(){$("#wizard-modal").modal("hide")}),500)}function resetWizard(){localStorage.setItem("ShowWizard",yes)}function showInfo(e){$("#info-message").html(e),$("#info-progressbar").css("width","0%").text("0%"),$("#info-modal").modal("show")}function cancelInfo(){$("#info-progressbar").css("width","100%").text("100%"),setTimeout((function(){$("#info-modal").modal("hide")}),500)}function showUserInfo(e){$("#user-message").html(e),$("#usrmsg-modal").modal("show")}function showError(e){$("#serious-error-message").html(e),$("#serious-error-modal").modal("show")}function cancelError(){setTimeout((function(){$("#serious-error-modal").modal("hide")}),500)}function showSDWarning(){$("#sd-warning").modal("show")}function cancelSDWarning(){setTimeout((function(){$("#sd-warning").modal("hide")}),500)}function showHeaterWarning(){$("#heater-warning").modal("show")}function cancelHeaterWarning(){setTimeout((function(){$("#heater-warning").modal("hide")}),500)}function showChangesPending(e){e?$("#changes-pending").show():$("#changes-pending").hide(),changesPending=e}function replaceId(e){return e=(e=(e=(e=(e=(e=(e=e.replace("Selector-","")).replace("Feeder-","")).replace("Revolver-","")).replace("TMC-","")).replace("Output-","")).replace("HumidityLevel-","")).replace("DynFanSpeed-","")}function normalizeId(e){var t=-1;return e.startsWith("Material-")&&(t=e.substring(9),e=e.substring(0,8)),e.startsWith("Color-")&&(t=e.substring(6),e=e.substring(0,5)),e.startsWith("PFactor-")&&(t=e.substring(8),e=e.substring(0,7)),e.startsWith("CValue-")&&(t=e.substring(7),e=e.substring(0,6)),e.startsWith("Spool-")&&(t=e.substring(6),e=e.substring(0,5)),e.startsWith("CCW-")&&(t=e.substring(4),e=e.substring(0,3)),e.startsWith("Close-")&&(t=e.substring(6),e=e.substring(0,5)),e.startsWith("Output-")&&(t=e.substring(7),e=e.substring(0,6)),e.startsWith("Mode-")&&(t=e.substring(5),e=e.substring(0,4)),e.startsWith("RevolverClose-")&&(t="T"+e.substring(14),e=e.substring(0,13)),e.startsWith("baudrate-")&&(t=e.substring(9),e=t),e.startsWith("HumidityLevel-")&&(t=e.substring(14),e=e.substring(0,13)+"s"),e.startsWith("DynFanSpeed-")&&(t=e.substring(12),e=e.substring(0,11)+"s"),[e,t]}function buildM205Command(e){var t,o=e.prop("id");if("M"==o&&"C"==o&&"CV"==o&&"PF"==o&&"O"==o&&"P"==o)return"";var a=e.prop("localName"),n=e.prop("type"),i=(e.attr("data-section"),e.attr("data-subsection"));if(""==o&&console.log(">>> No ID <<< for prop: "+a+" of type: "+n),"input"!=a&&"select"!=a||(t="text"==n?'"'+e.val()+'"':"color"==n?'"'+e.val().substring(1)+'"':"checkbox"==n?e.is(":checked")?1:0:isNaN(e.val())?null:e.val()),null!=t){const e=normalizeId(o=replaceId(o));o.startsWith("baudrate-")?(o="Baudrates",t='"'+t+'"'):o=e[0],idx=e[1];var r="",s="";if(void 0!==i){switch(i){case"Selector":r="X",s="I"+idx;break;case"Revolver":r="Y",s="I"+idx;break;case"Feeder":r="Z",s="I"+idx;break;case"User1":case"User2":s="M",o=i;break;case"HumidityLevels":case"DynFanSpeeds":s="I"+o,o=i}i.startsWith("T")&&(s="I"+i.substring(1))}return'M205P"'+o+'" S'+t+" "+r+s}return console.log("Skipping null value..."),""}function checkForChange(e){if(!initDone)return;var t=!1,o=replaceId(e.attr("id"));const a=normalizeId(o);if(o=a[0],idx=a[1],!o.startsWith("Dlvl-")){var n,i,r=e.attr("data-section"),s=e.attr("data-subsection"),l="checkbox"==e.prop("type"),c=JSON.parse(localStorage.getItem("M503"+r)),d="";if(void 0!==s?d=c[s][o]:void 0===(d=c[o])&&(d=c[idx],t=!0),void 0!==d){if(l?(e.tooltip("hide"),1==e.prop("checked")?"boolean"==typeof d?(n=!0,i=yes):"string"==typeof d?n=i=output:(n=1,i=high):"boolean"==typeof d?(n=!1,i=no):"string"==typeof d?n=i=pwm:(n=0,i=low),e.attr("data-bs-original-title",i),e.attr("aria-label",i)):n=e.val(),d!=n)try{return void 0!==s?c[s][o]=n:t?c[idx]=n:c[o]=n,localStorage.setItem("M503"+r,JSON.stringify(c)),!0}catch(e){console.log(e)}}else showToast(valUndefined+o+subSection+s+subSectionEnd),console.log("val undefined?!");return!1}}async function saveConfig(){sendGcode("M500"),getResponse()&&($("#restart-modal").modal("show"),showChangesPending(!1))}function removeValFeedback(){$("#accordion-settings input, #accordion-settings select").each((function(){$(this).removeClass("val-changed"),$(this).removeClass("val-failed")}))}function setGcodeHistory(){if(-1!=historyIndex){var e=$($("#historyitemscontainer").children())[historyIndex],t=$(e).find("span").text();$("#gcode").val(t),setTimeout((function(){$("#gcode").focus()}),100)}}function setLidIcon(e){var t=$("#card-lid").find("i");t.data("state",e),t.removeClass("fa-unlock fa-lock icon-unchecked icon-checked"),t.addClass("0"==e?"fa-unlock icon-unchecked":"fa-lock icon-checked"),setServoHorn(e)}function getCurrentTool(){var e=$("#tool-selection").val();return"-1"==e?-1:null!=e?parseInt(e.substring(1)):-1}function setServoHorn(e){var t=parseInt($("#Revolver-ServoOpen").val()),o=parseInt($("#Revolver-ServoClose").val()),a=getCurrentTool();-1!=a&&(o=parseInt($("#Close-"+a).val()));var n=e?90-o:90-t;if(!isNaN(n))if($("#lvc-horn").css({transform:"rotate("+n+"deg)"}),"#sec-live-control"==$(".nav-item.activeSection").data("section")){var i=e?o:t;$("#lvc-horn-image").attr("data-bs-original-title",i+" deg").tooltip("update")}else $("#sec-live-control .tooltip").each((function(){$(this).tooltip("hide")}))}async function recalculateSpeeds(){if(initDone){for(var e=[["Selector-MaxSpeed","X"],["Selector-AccelSpeed","X"],["Revolver-MaxSpeed","Y"],["Revolver-AccelSpeed","Y"],["Feeder-MaxSpeed","Z"],["Feeder-AccelSpeed","Z"],["Feeder-InsSpeed","Z"],["Feeder-PurgeSpeed","Z"]],t=0;t<e.length;t++){var o=$("#"+e[t][0]).val();if(""!=o)sendGcode('M205P"XlateSpeed"S'+o+e[t][1]),await getResponse()&&$("#"+e[t][0]).val(parseInt(xlatedSpeed));else console.log('Speed "'+e[t]+'" is not set!')}showToast(speedsTranslated)}}function setDisabled(e,t){var o=$(t+" input,"+t+" select"),a=$(t+" label,"+t+" span, "+t+" i, "+t+" div");e?(o.each((function(){$(this).attr("disabled","disabled"),$(this).css("opacity","0.5")})),a.each((function(){$(this).css("opacity","0.5")}))):(o.each((function(){$(this).removeAttr("disabled"),$(this).css("opacity","1")})),a.each((function(){$(this).css("opacity","1")})))}function setAutocompleteColors(e){new Autocomplete(e,{data:colorNames,maximumItems:5,treshold:1});$(e).on("focusout",(function(){$(this).parent().find()}))}function setAutocompleteMaterials(e){new Autocomplete(e,{data:materialNames,maximumItems:5,treshold:1})}async function sendUploadRequest(e,t){if(sendGcode('M997 P"/'+e+'" L'+t),!await getResponse())return showToast(uploadingFailed),!1;uploadCancelled=!1}async function sendUploadStart(){return sendGcode(String.fromCharCode(27,85),!1,!1),!!await getResponse()||(showToast(abortingUpload),!1)}async function sendBuffer(e){var t=e.length;$("#progress-upload .progress-bar").css("width","0%"),$("#progress-upload .progress-bar").text("0%");for(var o=0;o<t;o++){await sendChar(String.fromCharCode(e[o]));var a=parseFloat(o/t*100);if(o>0&&o%50==0&&await sleep(100),$("#progress-upload .progress-bar").css("width",a+"%"),$("#progress-upload .progress-bar").text(parseInt(a)+"%"),uploadCancelled)break;pauseTransmission&&await getResume()}$("#progress-upload .progress-bar").css("width","100%"),$("#progress-upload .progress-bar").text("100%"),$("#firmware-file").val(""),setTimeout((function(){$("#firmware-upload-modal").modal("hide")}),2e3)}function showUserMessage(e){try{var t=JSON.parse(e.replaceAll('""','"')).UserMessage;t.startsWith("SD-Card removed.")||showUserInfo(t)}catch(e){console.log("Can't show User Message because: ",e)}}function showUserDialog(e){try{var t=JSON.parse(e);lastDlgId=t.UserDialog.Id;var o=t.UserDialog.Title,a=t.UserDialog.Message,n=t.UserDialog.Action,i=t.UserDialog.Buttons;gotDlgButton=!1,$("#usrdlg-title").html('<i class="fa" fa-question-circle-o fa-2x mx-2></i>'+o.replaceAll("\\n"," ")),$("#usrdlg-message").text(a.replaceAll("\\n","<br/>")),$("#usrdlg-action").text(n.replaceAll("\\n","<br/>"));var r=i.split("|");$("#btn-usrdlg-modal-1").addClass("d-none"),$("#btn-usrdlg-modal-2").addClass("d-none"),$("#btn-usrdlg-modal-3").addClass("d-none"),r.length>=1&&($("#btn-usrdlg-modal-1").text(r[0].trim()),$("#btn-usrdlg-modal-1").removeClass("d-none")),r.length>=2&&($("#btn-usrdlg-modal-2").text(r[1].trim()),$("#btn-usrdlg-modal-2").removeClass("d-none")),r.length>=3&&($("#btn-usrdlg-modal-3").text(r[2].trim()),$("#btn-usrdlg-modal-3").removeClass("d-none")),$("#usrdlg-modal").modal("show")}catch(e){console.log("Can't show User Dialog because: ",e)}}function sendDialogResult(e,t){sendGcode('{ "UserDialog": { "Id": '+e+', "Button": '+t+" } }",!1,!1,!0)}var sensor1Chart,sensor2Chart,isStandalone=!1,initDone=!1,initStarted=!1,seenOk=!1,seenError=!1,seenParserError=!1,prevLine="",configType="",currentSerial=-1,xlatedSpeed=0,collectResponse=!1,responseBuffer="",isPurging=!1,isBooting=!1,pauseTransmission=!1,temperature1=0,temperature2=0,humidity1=0,humidity2=0,heater1=0,heater1Target=0,heaterOn=!1,heaterTimeout=0,dryerFan1Speed=0,dryerFan2Speed=0,isDrying=!1,isFan1Dynamic=!1,isHeaterSet=!1;function sleep(e){return new Promise((t=>setTimeout(t,e)))}function getResponse(){return new Promise((e=>gotOk(e)))}function getResume(){return new Promise((e=>gotXon(e)))}async function gotOk(e){for(var t=1e4;!seenOk;)await sleep(10),(t-=10)<=0&&e(!1);collectResponse=!1,e(!seenError)}async function gotXon(e){for(var t=1e4;pauseTransmission;)await sleep(10),(t-=10)<=0&&e(!1);e(!0)}async function connectHandler(){isTestRunning?($(".nav-item.activeSection").removeClass("activeSection"),$('.nav-item[data-section="#sec-testrun"]').trigger("click")):await requestInit()?hideConnect():(isStandalone||await disconnectSerial(),showConnect())}async function sendGcode(e,t,o,a=!0){if(console.log("Gcode: "+e),seenOk=!1,seenError=!1,0!=e.length){e.trim().toUpperCase().startsWith("M20L")&&(responseBuffer="",collectResponse=!0),e.trim().toUpperCase().startsWith("G1")&&(e.toUpperCase().indexOf("X")>-1&&$("#selector-pwr-off").addClass("hidden"),e.toUpperCase().indexOf("Z")>-1&&$("#feeder-pwr-off").addClass("hidden")),e.trim().toUpperCase().startsWith("M500")&&showChangesPending(!1);var n=e;a&&(e+="\r\n"),await(isStandalone?writeSerial(e):writeWebSerial(e)),await sleep(5),t&&addSentGcode(n),o&&$("#gcode").focus()}}async function sendChar(e){await(isStandalone?writeSerial(e):writeWebSerial(e))}function sendCharSync(e){isStandalone?writeSerial(e):writeWebSerial(e)}function sendPFKey(e){var t=String.fromCharCode(27,91,79,e);console.log("Seq: "+t),addSentGcode("[PF"+String.fromCharCode(e-31,93)),sendGcode(t,!1,!0)}async function sendInitSeq(e){var t=3,o=!1;do{if(sendGcode(e,!1,!1),await getResponse()&&!seenParserError){o=!0;break}showInfo(connectionFailedRetry),await sleep(1e3),cancelInfo(),t--}while(t>0);return o}async function requestTMCInit(){if(curFWVersion>=3.11)await sendInitSeq("M122W99");else{await sendInitSeq("M17");for(var e=0;e<4&&await sendInitSeq("M122W"+e);e++);}initDone=!0}async function requestInit(){try{if(1==initStarted)return!1;initStarted=!0,initDone=!1,addSentGcode(wiInitStart),showInfo(fetchingSettings);var e=!0;if(isStandalone&&(await sendInitSeq("M155S0")||(e=!1)),await sendInitSeq("M115")||(e=!1),e){var t=[];t=curFWVersion>=3.11?['M205P"WebInterface"S1',"M111W1","M503S0W",'M20S"/test" F"" W',"M155S1"]:['M205P"WebInterface"S1',"M111W1","M503S0W","M503S6W","M503S7W","M503S8W",'M20S"/test" F"" W','M205P"SendStats"S1'];for(var o=0;o<t.length;o++){var a=parseInt(100/t.length*(o+1));if($("#info-progressbar").css("width",a+"%").text(a+"%"),isTestRunning||initDone)break;if(!await sendInitSeq(t[o])){e=!1;break}}addSentGcode(wiInitEnd)}else addSentGcode(wiInitFailed);return cancelInfo(),showChangesPending(!1),initStarted=!1,hasTmc?setTimeout((function(){requestTMCInit()}),100):initDone=!0,e}catch(e){console.log(e)}return!1}function playSequence(e){try{var t;switch(JSON.parse(e).PlaySequence){case"Beep":t=$("#audio-beep");break;case"LongBeep":t=$("#audio-longbeep");break;case"Startup":t=$("#audio-startup");break;case"User":t=$("#audio-user");break;case"Dryer":t=$("#audio-dryer")}null!=t&&t[0].canPlayType("audio/ogg")&&t[0].play()}catch(e){console.log("Can't play audio because: ",e)}}async function parseResponse(e){if(prevLine=e,seenParserError=!1,isBooting){if(e.startsWith('{"PlaySequence'))return void playSequence(e);if("start"!=e)return $("#info-message").html(bootingMsg+"<br/><p>"+e.substring(11)+"</p>"),void addReceivedGcode(e.replaceAll(" ","&nbsp;"))}if(e.startsWith("ok")){if(seenOk=!0,(isShowingLoading||isShowingUnloading)&&((isShowingLoading&&!isPurging||isShowingUnloading)&&cancelInfo(),isShowingLoading=!1,isShowingUnloading=!1),!initDone)return}else if(e.startsWith("error:")||e.startsWith("echo: error"))seenError=!0,"BUSY"==e.substring(7)&&showToast(smuffBusy),console.log("Errors seen: "+seenError+" [ "+prevLine+" ]");else if("start"==e)isBooting=!1,cancelInfo(),initDone&&(setTimeout((function(){showInfo(fetchingSettings)}),1e3),requestInit());else if(e.indexOf("echo: ")>-1)if(e.indexOf(" dbg:")>-1)e.indexOf("setup start")>0&&(isBooting=!0,initDone=!0,showInfo(bootingMsg));else{if(e.indexOf(" Serial:")>-1)return currentSerial=parseInt(e.substring(e.indexOf(" Serial:")+9)),void $("#curSerial"+currentSerial).removeClass("hidden");if(e.indexOf(" states:")>-1)return void setStatus(e);if(e.indexOf(" testrun:")>-1)return setTestResults(e),void showTestRunning(!0);if(e.indexOf(" purging:")>-1)return void("done"==e.substring(e.indexOf(" purging:")+9)?(isPurging=!1,cancelInfo()):(isPurging=!0,showPurging(e.substring(e.indexOf(" purging:")+9))));if(e.indexOf(" speed:")>-1)return void(xlatedSpeed=e.substring(e.indexOf(" speed:")+7));if(e.indexOf(" update:")>-1){var t=e.indexOf(" update:")+8;return"done"==e.substring(t)&&console.log("Update done!"),"failed"==e.substring(t)&&console.log("Update failed!"),void("progress"==e.substring(t)&&(progress=e.substring(t+9),console.log("Update progress: "+progress+"%")))}if(e.indexOf(" WI-ESP:")>-1){t=e.indexOf(" WI-ESP:")+8;return void addReceivedGcode(e=e.substring(0,t)+'<span class="wi-esp">'+e.substring(t).replaceAll(" ","&nbsp;").replaceAll("\n","<br/>")+"</span>")}if((e.indexOf(" INT")>-1||e.indexOf(" EXT")>-1)&&(setRelayState(e.substring(e.indexOf("echo: ")+6)),!initDone))return}else if(e.startsWith("FIRMWARE_NAME"))setFWInfo(e);else{if(e.startsWith("Unknown parameter 'WebInterface"))return initDone=!0,void showError("Apparently, this SMuFF-Firmware version is <b>less than 2.26</b>! Please update your firmware for this app.");if(e.startsWith("/*")){if(configType=e.replace("/*","").replace("*/","").trim(),!initDone)return void(configType.startsWith("Testscripts")&&(addTestFiles(configType.substring(12)),configType=""))}else if(e.startsWith('{"')){if(e.indexOf("UserMessage")>-1)return void showUserMessage(e);if(e.indexOf("UserDialog")>-1)return void showUserDialog(e);if(e.indexOf("PlaySequence")>-1)return void playSequence(e);if(e.indexOf("TMCStatus")>-1&&(configType="TMC"),setSettings(e,configType),!initDone)return}else for(var o=["M17","M111","M122","M155","M205","M503"],a=0;a<o.length;a++)if(e.startsWith(o[a])){if(initDone)break;return}}addReceivedGcode(e.replaceAll(" ","&nbsp;"))}var dryerProfiles,dryerProfilesJson,websock=null,firstWebSockInit=!0,webSockOpenFailed=!1,collectWSData="";function openWebSock(){(websock=new WebSocket("ws://"+location.host+":8080/smuff-wi")).onopen=function(e){console.log("WebSocket connection is open..."),webSockOpenFailed=!1,setTimeout((function(){firstWebSockInit&&(firstWebSockInit=!1),connectHandler()}),50)},websock.onerror=function(e){console.log("WebSocket has reported an error: ",e),webSockOpenFailed=!0},websock.onclose=function(e){var t=connectionClosed;firstWebSockInit=!0,e.wasClean?console.log("WebSocket connection has been closed normally!"):(console.log("WebSocket connection has been killed!"),console.log("Code: "+e.code,"See: https://datatracker.ietf.org/doc/html/rfc6455#section-7.4.1"),t=connectionFailed),showConnectingMessage("fast",t,null)},websock.onmessage=function(e){(collectWSData+=e.data).endsWith("\n")&&(parseIncomingData(collectWSData.substring(0,collectWSData.length-1)),collectWSData="")}}async function sendWebSock(e){null!==websock&&"undefined"!==websock&&1==websock.readyState||openWebSock(),waitForSocketConnection(websock,(function(){0==websock.bufferedAmount?websock.send(e):(console.log("Waiting for WebSocket buffer to empty..."),waitForBufferEmpty(websock,(function(){websock.send(e)})))}))}function waitForBufferEmpty(e,t){setTimeout((function(){0!=e.bufferedAmount?waitForBufferEmpty(e,t):null!=t&&t()}),150)}function waitForSocketConnection(e,t){setTimeout((function(){1!==e.readyState?waitForSocketConnection(e,t):null!=t&&t()}),50)}var chartTooltips={callbacks:{label:tooltipLabelCb,afterLabel:tooltipAfterLabelCb}},chartZoomPan={zoom:{enabled:!0,drag:!1,wheel:{enabled:!0},speed:100,sensitivity:1,threshold:2,mode:"x",onZoom:function(e){},onZoomComplete:function(e){console.log(e),2==e.chart.id&&setZoomDisabled(!1,"#icon-reset-zoom1-sec"),3==e.chart.id&&setZoomDisabled(!1,"#icon-reset-zoom2-sec")}},pan:{enabled:!0,mode:"xy",modifierKey:"shift",threshold:2,speed:.5,rangeMin:{y:0},rangeMax:{y:200}},limits:{y:{min:0,max:100},y2:{min:-5,max:5}}},chartScales={yAxes:[{id:"y-axis-heater",type:"linear",position:"left",display:!0,ticks:{suggestedMin:0,suggestedMax:150},scaleLabel:{display:!0,labelString:"Temperature (°C)"}},{id:"y-axis-aht",type:"linear",position:"right",display:!0,gridLines:{color:"rgba(63,152,255,0.25)"},ticks:{suggestedMin:0,suggestedMax:100},scaleLabel:{display:!0,labelString:"Humidity (%)"}}]};function tooltipLabelCb(e,t){var o=t.datasets[e.datasetIndex];return prev=e.index>0?o.data[e.index-1]:0,val=o.data[e.index],lbl=o.label+": ",0==e.datasetIndex?lbl+val+"% RH":lbl+val+"°C"}function tooltipAfterLabelCb(e,t){var o=t.datasets[e.datasetIndex],a=e.index;do{if(prev=a>0?o.data[a-1]:0,--a<0)break}while(null==prev);return val=o.data[e.index],delta="Δ "+(val-prev>=0?"+":"")+(val-prev).toFixed(1),0==e.datasetIndex?delta+"%":delta+"°C"}function initSensorCharts(){var e=parseInt($("#HeaterMaxTemp").val());sensor1Chart.options.elements.point.radius=2,sensor1Chart.options.scales=chartScales,sensor1Chart.options.tooltips=chartTooltips,sensor1Chart.options.plugins.zoom=chartZoomPan,sensor1Chart.options.scales.yAxes[0].ticks.suggestedMax=e,sensor1Chart.options.plugins.zoom.pan.rangeMax.y=e,sensor2Chart.options.elements.point.radius=2,sensor2Chart.options.scales=chartScales,sensor2Chart.options.tooltips=chartTooltips,sensor2Chart.options.plugins.zoom=chartZoomPan,sensor2Chart.options.scales.yAxes[0].ticks.suggestedMax=e,sensor2Chart.options.plugins.zoom.pan.rangeMax.y=e,sensor1Chart.data.labels=[];for(var t=0;t<sensor1Chart.data.datasets.length;t++)sensor1Chart.data.datasets[t].data=[];sensor2Chart.data.labels=[];for(t=0;t<sensor2Chart.data.datasets.length;t++)sensor2Chart.data.datasets[t].data=[];setZoomDisabled(!0,"#icon-reset-zoom1-sec"),setZoomDisabled(!0,"#icon-reset-zoom2-sec")}function logSensor(e,t,o,a,n){var i=(new Date).toTimeString().substring(0,8),r=sensor1Chart.data.labels.length,s=sensor2Chart.data.labels.length;if(1==e){if(sensor1Chart.data.labels[r]=i,sensor1Chart.data.datasets[0].data[r]=o,sensor1Chart.data.datasets[1].data[r]=t,sensor1Chart.data.datasets[2].data[r]=a,sensor1Chart.data.datasets[3].data[r]=n,r>100){sensor1Chart.data.labels.shift();for(var l=0;l<sensor1Chart.data.datasets.length;l++)sensor1Chart.data.datasets[l].data.shift()}sensor1Chart.update()}if(2==e){if(sensor2Chart.data.labels[s]=i,sensor2Chart.data.datasets[0].data[s]=o,sensor2Chart.data.datasets[1].data[s]=t,s>100){sensor2Chart.data.labels.shift();for(l=0;l<sensor2Chart.data.datasets.length;l++)sensor2Chart.data.datasets[0].data.shift()}sensor2Chart.update()}}function durationToDate(){var e=$("#drying-duration").val(),t=Date.parse("2024-01-01T"+e+":00");return new Date(t)}function createDefaultDryerProfiles(){localStorage.setItem("DryerProfiles",'{"Profile":[{"Name":"PLA, 3h at 75C",  "Duration":180, "TargetTemp":75,  "Fan1":0,  "Fan2":50, "DynFan":true},{"Name":"PETG,6h at 95C",  "Duration":360, "TargetTemp":95,  "Fan1":0,  "Fan2":50, "DynFan":true},{"Name":"ASA, 5h at 100C", "Duration":300, "TargetTemp":100, "Fan1":0,  "Fan2":50, "DynFan":true},{"Name":"PA,  6h at 125C", "Duration":360, "TargetTemp":125, "Fan1":75, "Fan2":50, "DynFan":false}]}')}function deleteAllDryerProfiles(){localStorage.removeItem("DryerProfiles")}function createNewProfileItem(e,t,o,a,n,i){var r=JSON.parse('{"Name":"",  "Duration":0, "TargetTemp":0,  "Fan1":0,  "Fan2":0, "DynFan":false}');return r.Name=e,r.Duration=t,r.TargetTemp=parseInt(o),r.Fan1=parseInt(a),r.Fan2=parseInt(n),r.DynFan=!!i,r}function addProfileItem(e){if(null==dryerProfilesJson)return console.log("No valid JSON object for profiles found!"),!1;null!=e&&(pos=dryerProfilesJson.Profile.length,dryerProfilesJson.Profile[pos]=e)}function removeProfileItem(e){if(null==dryerProfilesJson)return console.log("No valid JSON object for profiles found!"),!1;if(null!=e){var t=0,o=!1;for(var a of dryerProfilesJson.Profile){if(a.Name==e){o=!0;break}t++}return o&&dryerProfilesJson.Profile.splice(t,1),o}}function storeLocalProfiles(){localStorage.setItem("DryerProfiles",JSON.stringify(dryerProfilesJson))}function getLocalProfile(e){for(var t of dryerProfilesJson.Profile)if(t.Name==e)return t;return null}function getLocalProfiles(){if(null!=(dryerProfiles=localStorage.getItem("DryerProfiles"))){var e=$("#dryer-profiles");for(var t of(e.empty().append($("<option>",{text:"None"})),(dryerProfilesJson=JSON.parse(dryerProfiles)).Profile))null!=t&&null!=t.Name&&e.append($("<option>",{text:t.Name}))}}function selectProfile(e){$("#dryer-profiles option").each((function(){$(this).val()==e&&($(this).selected=!0,$("#dryer-profiles").trigger("change"))}))}function setZoomDisabled(e,t){e?($(t).attr("disabled","disabled"),$(t).css("opacity","0.5"),$(t).css("cursor","default")):($(t).attr("disabled",""),$(t).css("opacity","1"),$(t).css("cursor","pointer"))}async function animateWiper(){var e=0,t=0,o=100,a=$("#WipeSeq").val().matchAll(/([a-zA-Z]\d{1,3})/g);for(const o of a)o[0].toUpperCase().startsWith("R")&&(e=parseInt(o[0].substring(1))),o[0].toUpperCase().startsWith("S")&&(t=parseInt(o[0].substring(1)));var n=7*t;$("#lvc-wiper-image-1").hide(),$("#lvc-wiper-image-2").show(),await sleep(o),$("#lvc-wiper-image-2").hide(),$("#lvc-wiper-image-3").show(),await sleep(o);for(var i=0;i<e;i++)$("#lvc-wiper-image-3").hide(),$("#lvc-wiper-image-4").show(),await sleep(n),$("#lvc-wiper-image-4").hide(),$("#lvc-wiper-image-3").show(),await sleep(n);$("#lvc-wiper-image-3").hide(),$("#lvc-wiper-image-2").show(),await sleep(o),$("#lvc-wiper-image-2").hide(),$("#lvc-wiper-image-1").show(),await sleep(o)}async function animateCutter(e){for(var t=0;t<3;t++)$("#lvc-cutter-image-1").hide(),$("#lvc-cutter-image-2").show(),await sleep(100),$("#lvc-cutter-image-2").hide(),$("#lvc-cutter-image-3").show(),await sleep(0==t?750:375),t<2&&($("#lvc-cutter-image-3").hide(),$("#lvc-cutter-image-2").show(),await sleep(100),$("#lvc-cutter-image-2").hide(),$("#lvc-cutter-image-1").show(),await sleep(100));e&&animateCutterEnd()}async function animateCutterEnd(){$("#lvc-cutter-image-3").hide(),$("#lvc-cutter-image-2").show(),await sleep(100),$("#lvc-cutter-image-2").hide(),$("#lvc-cutter-image-1").show(),await sleep(100)}function setFeederLed(e){$("#UseSplitter").is(":checked")?$("#lvc-feeder-led").css("opacity",0):$("#lvc-feeder-led").css("opacity",e?1:0)}function setSelectorLed(e){$("#lvc-selector-led").css("opacity",e?0:1)}function getRodPosition(e){var t=$("#Tools").val()-1,o=parseInt($("#Selector-Spacing").val()*t),a=parseInt(e-$("#lvc-rod").offset().left),n=$("#lvc-rod").width();return parseInt((n-a)*(o/n))}function positionCarrier(e){var t=$("#Tools").val(),o=parseInt($("#Selector-Spacing").val())*t;e*=$("#lvc-rod").width()/o,$("#lvc-carrier").css("right",90+e+"px")}function setSplitterOption(){$("#UseSplitter").is(":checked")?($("#lvc-bottom").addClass("hidden"),$("#lvc-feed").addClass("hidden"),$("#lvc-bottom-splitter").removeClass("hidden"),$('[id^="lvc-fitting-"]').each((function(){$(this).removeClass("hidden")})),$('[id^="lvc-in-splitter-"]').each((function(){$(this).removeClass("hidden")})),$("#btn-load-to-splitter").removeClass("disabled"),$("#btn-unload-from-splitter").removeClass("disabled")):($("#lvc-bottom").removeClass("hidden"),$("#lvc-feed").removeClass("hidden"),$("#lvc-bottom-splitter").addClass("hidden"),$('[id^="lvc-fitting-"]').each((function(){$(this).addClass("hidden")})),$('[id^="lvc-in-splitter-"]').each((function(){$(this).addClass("hidden")})),$("#btn-load-to-splitter").addClass("disabled"),$("#btn-unload-from-splitter").addClass("disabled"))}function loadUnloadSplitter(e){var t=getCurrentTool();-1!=t?e==t?1==feedLoadState[t]?$("#btn-unload-from-splitter").trigger("click"):$("#btn-load-to-splitter").trigger("click"):showToast(toolNotSelected):showToast(noToolSelected)}function loadUnload(e){var t;-1!=(t=getCurrentTool())?e==t?$("#UseSplitter").is(":checked")?2==feedLoadState[e]?$("#btn-unload").trigger("click"):$("#btn-load").trigger("click"):isFeederLoaded?$("#btn-unload").trigger("click"):$("#btn-load").trigger("click"):showToast(toolNotSelected):showToast(noToolSelected)}async function parseIncomingData(e){await parseResponse(e)}async function writeSerial(e){await sendWebSock(e)}$(document).ready((function(){$("#fan1-label, #fan1-label-sec").css("cursor","pointer"),$("#fan2-label, #fan2-label-sec").css("cursor","pointer"),$("#dryer-label").css("cursor","pointer"),$("#heater1-target-label, #heater1-target-label-sec").css("cursor","pointer"),$("#timeout-div").css("cursor","pointer"),$("#sensor1-label").css("cursor","pointer"),$("#sensor2-label").css("cursor","pointer"),$("#heater1-label").css("cursor","pointer"),$("#icon-reset-zoom1-sec").css("cursor","pointer"),$("#icon-reset-zoom2-sec").css("cursor","pointer"),$("#timeout-div").on("click",(function(){isDrying&&$("#stop-dryer-modal").modal("show")})),$("#icon-reset-zoom1-sec").on("click",(function(){sensor1Chart.resetZoom(),setZoomDisabled(!0,"#icon-reset-zoom1-sec")})),$("#icon-reset-zoom2-sec").on("click",(function(){sensor2Chart.resetZoom(),setZoomDisabled(!0,"#icon-reset-zoom2-sec")})),$("#sensor1-label, #sensor2-label, #heater1-label").on("click",(function(){$('.nav-item[data-section="#sec-dryer"]').trigger("click")})),$("#heater1-target-label, #heater1-target-label-sec").on("click",(function(){isDrying&&($("#input-target-temp").val(heater1Target),$("#input-target-temp").prop("max",$("#HeaterMaxTemp").val()),$("#input-target-temp").trigger("change"),$("#dryer-temp-modal").modal("show"))})),$("#dryer-label, #btn-dryer, #btn-dryer-sec").on("click",(function(){isDrying?$("#stop-dryer-modal").modal("show"):(getLocalProfiles(),$("#btn-modal-dryer-delete").prop("disabled","disabled"),$("#dryer-target-temp").prop("max",$("#HeaterMaxTemp").val()),$("#dryer-dyn-fan1").prop("checked",isFan1Dynamic),$("#dryer-modal").modal("show"))})),$("#fan1-label, #fan1-label-sec").on("click",(function(){var e=parseInt($("#fan1-label").text());$("#input-fan-speed").val(e),$("#input-fan-speed").trigger("change"),$("#fan-index").val(1),$("#fan-speed-modal").modal("show")})),$("#fan2-label, #fan2-label-sec").on("click",(function(){var e=parseInt($("#fan2-label").text());$("#input-fan-speed").val(e),$("#input-fan-speed").trigger("change"),$("#fan-index").val(2),$("#fan-speed-modal").modal("show")})),$("#dryer-profiles").on("change",(function(e){var t=$(e.target).find("option:selected").text();if("None"==t)$("#btn-modal-dryer-delete").prop("disabled","disabled"),$("#btn-modal-dryer-save").html(saveAsProfile);else{$("#btn-modal-dryer-delete").prop("disabled",""),$("#btn-modal-dryer-save").html(changeProfile);var o=getLocalProfile(t);if(null!=o){var a=o.TargetTemp;a>$("#HeaterMaxTemp").val()?(a=$("#HeaterMaxTemp").val(),$("#dryer-target-temp").css("background-color","var(--bs-warning)"),$("#dryer-target-temp").prop("title",tempIsLimited)):$("#dryer-target-temp").css("background-color","var(--bs-white)");var n=new Date(6e4*o.Duration).toISOString().substring(11,16);$("#drying-duration").val(n),$("#dryer-target-temp").val(a),$("#dryer-fan1-speed").val(o.Fan1),$("#dryer-fan2-speed").val(o.Fan2),$("#dryer-dyn-fan1").prop("checked",o.DynFan)}}})),$("#input-fan-speed").on("change",(async function(){$("#label-fan-speed").text($("#input-fan-speed").val()+"%")})),$("#input-fan-speed").on("input",(async function(){$("#label-fan-speed").text($("#input-fan-speed").val()+"%")})),$("#input-target-temp").on("change",(async function(){$("#label-target-temp").text($("#input-target-temp").val()+"°C")})),$("#input-target-temp").on("input",(async function(){$("#label-target-temp").text($("#input-target-temp").val()+"°C")})),$("#btn-modal-dryer-cancel").on("click",(async function(){$("#dryer-modal").modal("hide")})),$("#btn-modal-dryer-ok").on("click",(async function(){$("#dryer-modal").modal("hide");var e=durationToDate(),t=60*e.getHours()+e.getMinutes(),o=$("#dryer-target-temp").val(),a=$("#dryer-fan1-speed").val(),n=parseInt($("#dryer-fan2-speed").val())+2e3,i=$("#dryer-dyn-fan1").is(":checked")?1:0,r="M141 S"+o+" T"+t+" F"+a+" F"+n+" D"+i;console.log("Dryer: "+r),sendGcode(r,!1,!1),isDrying=!0,isFan1Dynamic=1==i,$("#btn-dryer-sec").text(stopDrying),isFan1Dynamic?showElement("#fan1-dynamic-sec",!1,!1):hideElement("#fan1-dynamic-sec",!1,!1)}));var e=null;$("#btn-modal-dryer-delete").on("click",(async function(){removeProfileItem($("#dryer-profiles").find("option:selected").text())&&(storeLocalProfiles(),getLocalProfiles(),selectProfile("None"))})),$("#btn-modal-dryer-save").on("click",(async function(){var t=$("#dryer-profiles").find("option:selected").text();if("None"!=t)e=getLocalProfile(t),$("#user-input-input").val(t);else{var o=durationToDate(),a=$("#dryer-target-temp").val();$("#user-input-input").val("Material, "+o.getHours()+"h at "+a+"C")}$("#user-input-title").text("Enter the Profile name"),$("#user-input-prompt").text("Enter a new name to create another profile or use the same name to overwrite the profile parameters."),$("#usrinput-modal").modal("show")})),$("#btn-user-input-modal-ok").on("click",(async function(){var t=$("#dryer-profiles").find("option:selected").text();$("#user-input-input").val()!=t&&(e=null);var o=$("#user-input-input").val(),a=durationToDate(),n=60*a.getHours()+a.getMinutes(),i=$("#dryer-target-temp").val(),r=$("#dryer-fan1-speed").val(),s=$("#dryer-fan2-speed").val(),l=$("#dryer-dyn-fan1").is(":checked");null!=e?(console.log(e.Name),e.Duration=n,e.TargetTemp=i,e.Fan1=r,e.Fan2=s,e.DynFan=l):addProfileItem(createNewProfileItem(o,n,i,r,s,l));storeLocalProfiles(),null==e&&(getLocalProfiles(),selectProfile(o))})),$("#btn-fan-speed-cancel").on("click",(async function(){$("#fan-speed-modal").modal("hide")})),$("#btn-fan-speed-ok").on("click",(async function(){$("#fan-speed-modal").modal("hide");var e=$("#input-fan-speed").val(),t=$("#fan-index").val();console.log("Fan speed on: "+t+" = "+e),sendGcode("M106 I"+t+" S"+e,!1,!1),isFan1Dynamic=!1,hideElement("#fan1-dynamic-sec",!1,!1)})),$("#btn-stop-dryer-modal-cancel").on("click",(async function(){$("#stop-dryer-modal").modal("hide")})),$("#btn-stop-dryer-modal-ok").on("click",(async function(){$("#stop-dryer-modal").modal("hide"),sendGcode("M141 S0"),isDrying=!1,$("#btn-dryer-sec").text(startDrying)})),$("#btn-target-temp-cancel").on("click",(async function(){$("#dryer-temp-modal").modal("hide")})),$("#btn-target-temp-ok").on("click",(async function(){$("#dryer-temp-modal").modal("hide"),sendGcode("M141 C"+$("#input-target-temp").val(),!1,!1)})),$("#btn-sensor-chart-modal-close").on("click",(async function(){$("#sensor-chart-modal").modal("hide")})),$("#btn-clear-data-1, #btn-clear-data-1-sec").on("click",(function(){sensor1Chart.data.labels=[];for(var e=0;e<4;e++)sensor1Chart.data.datasets[e].data=[];sensor1Chart.update(),loggingStart=0})),$("#btn-clear-data-2, #btn-clear-data-2-sec").on("click",(function(){sensor2Chart.data.labels=[];for(var e=0;e<2;e++)sensor2Chart.data.datasets[e].data=[];sensor2Chart.update(),loggingStart=0}))})),$(document).ready((function(){$("#lvc-cutter-image-2").hide(),$("#lvc-cutter-image-3").hide(),$("#lvc-wiper-image-2").hide(),$("#lvc-wiper-image-3").hide(),$("#lvc-wiper-image-4").hide(),$("#lvc-horn-image").tooltip({delay:{show:100,hide:100},trigger:"hover"}),$("#lvc-horn, #lvc-horn-image").on("click",(function(){-1!=getCurrentTool()?$("#card-lid").trigger("click"):showToast(noToolSelected)})),$("#lvc-rod").tooltip({delay:{show:100,hide:100},trigger:"manual"}),$("#lvc-rod").on("mousemove",(function(e){var t=getRodPosition(e.pageX);$("#lvc-rod").attr("data-bs-original-title",moveSelectorTo+t+millimeter).tooltip("update").tooltip("show")})),$("#lvc-rod").on("click",(async function(e){moveCarrierG1=!0,$("#selector-pwr-off").addClass("hidden");var t=getRodPosition(e.pageX);positionCarrier(t),sendGcode("G90",!1,!1),await getResponse(),sendGcode("G1X"+t,!1,!1),await getResponse(),sendGcode("G91",!1,!1),await getResponse()})),$("#lvc-home").on("click",(function(e){moveCarrierG1=!1,setServoHorn(!1),$("#tool-selection").val(-1).trigger("change")})),$("#lvc-selector").on("click",(function(e){sendGcode("M18X",!1,!1),$("#selector-pwr-off").removeClass("hidden")})),$("#lvc-feeder").on("click",(function(e){sendGcode("M18Z",!1,!1),$("#feeder-pwr-off").removeClass("hidden")})),$("#lvc-feed").on("click",(function(e){loadUnload(getCurrentTool())})),$("#lvc-cutter").on("click",(function(e){sendGcode("G12C"),animateCutter(!0)})),$("#lvc-wiper").on("click",(function(e){sendGcode("G12"),animateWiper()})),$("#lvc-reset").on("click",(function(e){$("#btn-reset").trigger("click")})),$("#lvc-tensioner").on("click",(function(e){showInfo(notExpected),setTimeout((function(){cancelInfo()}),4e3)})),$(".lvc-fitting").on("click",(function(){var e=parseInt($(this).prop("id").substring(12));isNaN(e)||(feedLoadState[e]>=1?loadUnload(e):loadUnloadSplitter(e))})),$(".lvc-in-splitter").on("click",(function(){var e=parseInt($(this).prop("id").substring(16));isNaN(e)||(2==feedLoadState[e]?loadUnload(e):loadUnloadSplitter(e))}))}));const noToolSelected="No tool selected!",toolNotSelected="Tool not active! Please select this tool first for moving the Selector over that tool.",moveSelectorTo="Move Selector to ",millimeter=" mm",notExpected='You didn\'t really think that would work, did you?<br/><br/><img src="assets/img/Smiley.png" alt=":o)">',historySavedLocally="History has been saved locally.",noWebSerial="Your browser doesn't support Web Serial! Please use the latest version of either <i>Google Chrome</i> or <i>Microsoft Edge</i> browser&hellip;<br/><br/><small><b>Please notice:</b> This app will not work on a mobile phone or tablet since the Web Serial API isn't implemented in the browsers of those devices!</small>",savingSettings="Saving Settings&hellip;",reloadingSettings="Reloading Settings&hellip;",toolSwapsSaved="Tool-Swaps have been saved.",copiedToClipboard="Console output copied to Clipboard.",fileNotFound="File Not Found!",fileNotReadable="File is not readable!",fileReadError="An error occurred reading this file.",uploadAborted="Firmware upload aborted!",saveSettingFailed="Setting this value on the SMuFF has failed!<br/><br/>Please check console output for detailed information.",tmcVersionMismatch="Version mismatch on TMC driver!<br/>Please check your hardware setup!",failedReadSettings="Failed to read settings from SMuFF. Please check your setup!",failedReadingTestFiles='Can\'t read test-files from SMuFF. Please check the "test" folder on your SD-Card!',valUndefined="WTF? val undefined?! id: <b>",subSection="</b> subsection: <b>",subSectionEnd="</b>",speedsTranslated="Speeds have been translated! Please check whether they were calculated correctly.",uploadingFailed="Uploading firmware failed! See console for details.",abortingUpload="SMuFF not responding. Aborting upload!",smuffBusy="SMuFF is BUSY",connectingSMuFF="Connecting with SMuFF, please pick a serial port&hellip;",connectingDevice="Connecting with device, please wait&hellip;",connectionFailedRetry="Connection failed, retrying&hellip;",connectionFailed="Connection failed",connectionClosed="Connection has been closed from server",serialConnectionFail="Serial connection failed!",clickToConnect="Click here to connect&hellip;",disconnected="Disconnected&hellip;",openingPort="Opening serial port&hellip;",serialPortOpen="Serial port sucessfully opened",fetchingSettings="Fetching settings from SMuFF, please wait&hellip;",wiInitStart="<<< WebInterface Init Start >>>",wiInitEnd="<<< WebInterface Init End >>>",wiInitFailed="<<< WebInterface Init Failed >>>",plzWait="<br/>Please wait&hellip;",loadingFilament="<h2>Loading Filament for ",loadingFilamentSpl=" to Splitter</h2>",unloadingFilamentSpl=" from Splitter</h2>",unloadingFilament="<h2>Unloading Filament for ",closeH2="</h2>",purging1="<h2>Purging Tool ",purging2="</h2>Amount: ",purging3=" mm or ",purging4=" mm³<br/>",fwWarning="This SMuFF-Firmware version is outdated for this app! Install at least version 2.26",ttpUnloadFromDDE="Unload from DDE",ttpUnloadFromSelector="Unload from Selector",ttpUnloadFromNozzle="Unload from Nozzle",ttpLoadToNozzle="Load to Nozzle",ttpLoadToSplitter="Load to Splitter",ttpLoadToDDE="Load to DDE",lidOnly="Lid",lidDDE="Lid / DDE",lidV6S="Lid / Revolver",lidV4="Revolver",noName="NO-NAME",servoMaps="Servo Angle Mappings",stepperMaps="Lid Stepper Mappings",stepperClosedAt="Closed @ mm",reqStepsMM="You have changed the micro stepping for <b>{ITEM}</b>.<br/><br/>Do you want me to correct the <i>Steps per Millimeter</i> setting to <b>{VAL}</b>?",pfButton="Button ",yes="Yes",no="No",never="Never",high="HIGH",low="LOW",pwm="PWM",output="OUTPUT",bootingMsg="<h2>SMuFF is booting&hellip;</h2>",noWiVersion="ATTENTION: Unable to check for latest WebInterface version! Your current version might be outdated!",tempIsLimited="Temperature is over the limit defined in Settings",saveAsProfile="Save as Profile &hellip;",changeProfile="Change Profile &hellip;",uploadSuccess="Firmware uploaded successfully. This dialog will close in a few seconds automatically and reload the page.",uploadFailed="Firmware upload has failed! Please try again.",dryerIdle="Idle",dryerHeating="Heating up",dryerCooling="Cooling down",dryerDrying="Drying",startDrying="Start Dryer",stopDrying="Stop Dryer";function getToolCount(){return""==$("#Tools").val()?-1:parseInt($("#Tools").val())}function setupMaterials(){var e=getToolCount();if(-1!=e){var t=$("#form-materials");t.empty(),t.append('<datalist id="datalistColors"></datalist>'),t.append('<datalist id="datalistMaterials"></datalist>');var o=t.find('datalist[id="datalistColors"]');for(key in Object.keys(colorNames)){var a='<option value="'+colorNames[key].label+'"/>';o.append(a)}for(key in o=t.find('datalist[id="datalistMaterials"]'),Object.keys(materialNames)){a='<option value="'+materialNames[key].label+'"/>';o.append(a)}for(var n=$("#materials-template"),i=0;i<e;i++){var r=n.clone(!0);r.prop("id","materials-tool-"+i),r.removeClass("hidden"),r.find("label").text("T"+i+":"),r.find("input").each((function(){$(this).prop("id",$(this).prop("name")+i),$(this).attr("data-section","S5"),$(this).attr("data-subsection","T"+i)})),t.append(r)}}}function setupServoMappings(){var e=getToolCount();if(-1!=e){var t=$("#form-servomaps");t.empty();for(var o=$("#servomap-template"),a=0;a<e;a++){var n=o.clone(!0);n.prop("id","servomap-"+a),n.removeClass("hidden"),n.find("label").text("T"+a+":"),n.find("input").each((function(){$(this).prop("id",$(this).prop("name")+a),$(this).attr("data-section","S4"),$(this).attr("data-subsection","T"+a)})),t.append(n)}}}function setupStepperMappings(){var e=getToolCount();if(-1!=e){var t=$("#form-servomaps");t.empty();var o=$("#servomap-template");$("#caption-closeat").text("Closed @ mm");for(var a=0;a<e;a++){var n=o.clone(!0);n.prop("id","steppermap-"+a),n.removeClass("hidden"),n.find("label").text("T"+a+":"),n.find("input").each((function(){$(this).prop("id","Revolver"+$(this).prop("name")+a),$(this).attr("data-section","S7"),$(this).removeAttr("data-subsection"),$(this).attr("max","10"),$(this).attr("step","0.1"),void 0!==stepperMappings[a]&&$(this).val(stepperMappings[a].toFixed(1))})),t.append(n)}}}function setupLiveControl(){var e=getToolCount();if(-1!=e){var t=$("#lvc-slot-container");t.empty();var o=$("#lvc-slot-template"),a=0,n=new Array,i=new Array;$(o).find('span[id="lvc-in-splitter"] >i').each((function(){n[a]=$(this).attr("data-bs-original-title"),i[a++]=$(this).attr("data-bs-placement")}));for(var r=e-2;r>0;r--){var s=o.clone(!0);s.prop("id","lvc-t-"+r),s.removeClass("hidden");var l=s.find('span[id="lvc-tool"]');l.prop("id","lvc-tool-"+r).data("tool",r),l.attr("data-bs-original-title","T"+r).tooltip("update"),(l=s.find('span[id="lvc-led"]')).prop("id","lvc-led-"+r),(l=s.find('img[id="lvc-fitting"]')).prop("id","lvc-fitting-"+r),l.attr("data-bs-original-title","Load/Unload").tooltip("update"),(l=s.find('span[id="lvc-in-splitter"]')).prop("id","lvc-in-splitter-"+r),a=0,l.find("i").each((function(){$(this).attr("data-bs-original-title",n[a]),$(this).attr("data-bs-placement",i[a++]).tooltip("update")})),t.append(s)}o.removeClass("d-flex").addClass("hidden");var c=e-1;$("#lvc-tool-Max").prop("id","lvc-tool-"+c).data("tool",c.toString()).attr("data-bs-original-title","T"+c).tooltip("update"),$("#lvc-led-Max").prop("id","lvc-led-"+c),$("#lvc-fitting-Max").prop("id","lvc-fitting-"+c),$("#lvc-in-splitter-Max").prop("id","lvc-in-splitter-"+c),$("#lvc-rod").width(e*$("#lvc-slot-template").width()),$('span[id^="lvc-tool-"]').unbind("click");$('span[id^="lvc-tool-"]').on("click",(function(){var e=$(this).prop("id").substring(9);moveCarrierG1=!1,setServoHorn(!1),$("#tool-selection").val("T"+e).trigger("change")}))}}function setupSwaps(){var e=getToolCount();if(-1!=e){var t=$("#swap-tools-container #slots ul"),o=$("#swap-tools-container #tools ul");t.empty(),o.empty();for(var a=0;a<e;a++){var n=$("#slot-item-template").clone(!0);n.append("<span>Slot "+a+":</span>"),n.append('<span class="slot-tool-color">'+(""!=toolColors[a]?"(":"")+toolColors[a]+(""!=toolColors[a]?")":"")+"</span>"),n.attr("id","slot"+a),t.append(n);var i=$("#swap-item-template").clone(!0);i.text(i.text()+(void 0===swapTools[a]?a:swapTools[a])),i.attr("id","swap-tool"+a),i.attr("data-id","st-"+swapTools[a]),i.css("cursor","grab"),i.append('<i class="fa fa-reorder"></i>'),o.append(i)}}}var port,textEncoder,writableStream,writer,readableStream,reader,current_fs,next_fs,previous_fs,left,opacity,scale,animating;async function connectSerial(e=115200){try{port=await navigator.serial.requestPort(),showInfo(openingPort),await port.open({baudRate:e,bufferSize:64}).then((function(){$("#info-message").html(serialPortOpen),textEncoder=new TextEncoderStream,writableStream=textEncoder.readable.pipeTo(port.writable),writer=textEncoder.writable.getWriter(),listenToSerial(),connectHandler()}))}catch{cancelInfo(),showConnectingMessage("fast",serialConnectionFail,null)}}async function disconnectSerial(){try{reader&&(await reader.cancel(),await readableStream.catch((()=>{})),reader=null,readableStream=null),writer&&(await writer.close(),await writableStream,writer=null,writableStream=null),port&&(await port.close(),port=null)}catch(e){console.log(e)}}async function listenToSerial(){const e=new TextDecoderStream;readableStream=port.readable.pipeTo(e.writable),reader=e.readable.getReader(),portListener=!0;try{for(var t="";;){const{value:e,done:n}=await reader.read();if(e)-1!=e.indexOf("")&&(pauseTransmission=!0,console.log("XOff"),t+=e.replaceAll("","")),-1!=e.indexOf("")?(pauseTransmission=!1,console.log("XOn"),t+=e.replaceAll("","")):t+=e;for(;t.length;){var o=t.indexOf("\n");if(-1==o)break;var a=t.substring(0,o);await parseResponse(a),collectResponse&&"ok"!=a&&(responseBuffer+=a+"\n"),t=t.substring(o+1)}if(n){reader.releaseLock();break}}}catch(e){console.log(e),disconnectSerial()}portListener=!1,showConnect()}async function writeWebSerial(e){await writer.write(e)}$(document).ready((function(){$("#Tools").on("change",(function(){var e=getToolCount(),t=$("#tool-selection");t.empty(),t.append('<option value="-1">T--</option>');for(var o=0;o<e;o++)t.append('<option value="T'+o+'">T'+o+"</option>");for(o=MAX_TOOLS-1;o>=e;o--)$("#tst-t"+o).parent().hide();setupMaterials(),hasV6S||setupServoMappings(),setupLiveControl(),setupSwaps(),hasV6S&&setupStepperMappings()})),$("#SpdsInMms").on("click",(function(){setTimeout((function(){recalculateSpeeds()}),750)})),$("#Feeder-SharedStepper").on("change",(function(){setDisabled(!(hasSharedStepper=$(this).is(":checked")),".hasSharedStepper"),setDisabled(!hasSharedStepper,".hasNotExtCtrl")})),$("#Feeder-UseEStop2").on("change",(function(){setDisabled(!$(this).is(":checked"),".has2ndEndstop")})),$("#Feeder-ExtCtrl").on("change",(function(){hasExtCtrl=$(this).is(":checked"),hasDDE||hasSharedStepper||setDisabled(hasExtCtrl,".hasNotExtCtrl")})),$("#UseCutter").on("change",(function(){setDisabled(!$(this).is(":checked"),".hasCutter")})),$("#Revolver-UseServo").on("change",(function(){hasV6S&&$(this).removeAttr("checked"),setDisabled(!$(this).is(":checked"),".hasServo"),hasV6S||setDisabled(!$(this).is(":checked"),".hasServoOpt")})),$("#InvRelay").on("change",(function(){initDone&&setTimeout((async function(){sendGcode("M17",!0,!1),await getResponse()}),500)})),$("#Selector-TMC-Mode").on("change",(function(){1==$(this).val()?($("#Selector-TMC-Params").show("slow"),$("#Selector-MS3").val(0).trigger("change")):$("#Selector-TMC-Params").hide("slow")})),$("#Feeder-TMC-Mode").on("change",(function(){1==$(this).val()?($("#Feeder-TMC-Params").show("slow"),$("#Feeder-MS3").val(0).trigger("change")):$("#Feeder-TMC-Params").hide("slow")})),$("#Revolver-TMC-Mode").on("change",(function(){1==$(this).val()?($("#Revolver-TMC-Params").show("slow"),$("#Revolver-MS3").val(0).trigger("change"),hasDDE||$("#Revolver-UseServo").prop("checked",!1).trigger("change")):$("#Revolver-TMC-Params").hide("slow")})),$("#Selector-MS3").on("change",(function(){$(this).val()>0&&$("#Selector-TMC-Mode").val(0).trigger("change")})),$("#Feeder-MS3").on("change",(function(){$(this).val()>0&&$("#Feeder-TMC-Mode").val(0).trigger("change")})),$("#Revolver-MS3").on("change",(function(){$(this).val()>0&&$("#Revolver-TMC-Mode").val(0).trigger("change")}))}));class Upload{constructor(){}doUpload(e,t,o,a,n){var i=new FormData(e);$.ajax({type:"POST",url:t,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",o,!1),e},success:function(e){null!=a&&a(e)},error:function(e){null!=n&&n(e)},async:!0,data:i,cache:!1,contentType:!1,processData:!1,timeout:6e4})}}function resetWizard(){$("#msform fieldset").each((function(){$(this).css("opacity",0),$(this).css("transform","scale(1)"),$(this).css("display","none")})),previous_fs=null,next_fs=null,$("#progressbar li").removeClass("active"),(current_fs=$("#fs-welcome")).css("opacity",1),current_fs.css("transform","scale(1)"),current_fs.css("display","block"),$("#progressbar li").eq($("fieldset").index(current_fs)).addClass("active")}!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("chart.js"),require("hammerjs")):"function"==typeof define&&define.amd?define(["chart.js","hammerjs"],t):(e=e||self).ChartZoom=t(e.Chart,e.Hammer)}(this,(function(e,t){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var o=e.helpers,a=e.Zoom=e.Zoom||{},n=a.zoomFunctions=a.zoomFunctions||{},i=a.panFunctions=a.panFunctions||{};function r(e,t){var a={};void 0!==e.options.pan&&(a.pan=e.options.pan),void 0!==e.options.zoom&&(a.zoom=e.options.zoom);var n=e.$zoom;t=n._options=o.merge({},[t,a]);var i=n._node,r=t.zoom&&t.zoom.enabled,s=t.zoom.drag;r&&!s?i.addEventListener("wheel",n._wheelHandler):i.removeEventListener("wheel",n._wheelHandler),r&&s?(i.addEventListener("mousedown",n._mouseDownHandler),i.ownerDocument.addEventListener("mouseup",n._mouseUpHandler)):(i.removeEventListener("mousedown",n._mouseDownHandler),i.removeEventListener("mousemove",n._mouseMoveHandler),i.ownerDocument.removeEventListener("mouseup",n._mouseUpHandler))}function s(e){var t=e.$zoom._originalOptions;o.each(e.scales,(function(e){t[e.id]||(t[e.id]=o.clone(e.options))})),o.each(t,(function(o,a){e.scales[a]||delete t[a]}))}function l(e,t,o){return void 0===e||("string"==typeof e?-1!==e.indexOf(t):"function"==typeof e&&-1!==e({chart:o}).indexOf(t))}function c(e,t){if(e.scaleAxes&&e.rangeMax&&!o.isNullOrUndef(e.rangeMax[e.scaleAxes])){var a=e.rangeMax[e.scaleAxes];t>a&&(t=a)}return t}function d(e,t){if(e.scaleAxes&&e.rangeMin&&!o.isNullOrUndef(e.rangeMin[e.scaleAxes])){var a=e.rangeMin[e.scaleAxes];t<a&&(t=a)}return t}function u(e,t,o,a){var n=e.max-e.min,i=n*(t-1),r=e.isHorizontal()?o.x:o.y,s=(e.getValueForPixel(r)-e.min)/n,l=i*s,u=i*(1-s);e.options.ticks.min=d(a,e.min+l),e.options.ticks.max=c(a,e.max-u)}function p(e,t,o,a){var i=n[e.type];i&&i(e,t,o,a)}function h(e,t,a,n,i,r){var c=e.chartArea;n||(n={x:(c.left+c.right)/2,y:(c.top+c.bottom)/2});var d=e.$zoom._options.zoom;if(d.enabled){s(e);var u,h="function"==typeof d.mode?d.mode({chart:e}):d.mode;u="xy"===h&&void 0!==i?i:"xy",o.each(e.scales,(function(o){o.isHorizontal()&&l(h,"x",e)&&l(u,"x",e)?(d.scaleAxes="x",p(o,t,n,d)):!o.isHorizontal()&&l(h,"y",e)&&l(u,"y",e)&&(d.scaleAxes="y",p(o,a,n,d))})),r?e.update({duration:r,easing:"easeOutQuad"}):e.update(0),"function"==typeof d.onZoom&&d.onZoom({chart:e})}}function f(e,t,a){var n,i=e.options.ticks,r=e.min,s=e.max,l=e.getValueForPixel(e.getPixelForValue(r)-t),c=e.getValueForPixel(e.getPixelForValue(s)-t),d=l=l.valueOf?l.valueOf():l,u=c=c.valueOf?c.valueOf():c;a.scaleAxes&&a.rangeMin&&!o.isNullOrUndef(a.rangeMin[a.scaleAxes])&&(d=a.rangeMin[a.scaleAxes]),a.scaleAxes&&a.rangeMax&&!o.isNullOrUndef(a.rangeMax[a.scaleAxes])&&(u=a.rangeMax[a.scaleAxes]),l>=d&&c<=u?(i.min=l,i.max=c):l<d?(n=r-d,i.min=d,i.max=s-n):c>u&&(n=u-s,i.max=u,i.min=r+n)}function m(e,t,o){var a=i[e.type];a&&a(e,t,o)}e.Zoom.defaults=e.defaults.global.plugins.zoom={pan:{enabled:!1,mode:"xy",speed:20,threshold:10},zoom:{enabled:!1,mode:"xy",sensitivity:3,speed:.1}},a.zoomFunctions.category=function(e,t,o,n){var i=e.chart.data.labels,r=e.minIndex,s=i.length-1,l=e.maxIndex,u=n.sensitivity,p=e.isHorizontal()?e.left+e.width/2:e.top+e.height/2,h=e.isHorizontal()?o.x:o.y;a.zoomCumulativeDelta=t>1?a.zoomCumulativeDelta+1:a.zoomCumulativeDelta-1,Math.abs(a.zoomCumulativeDelta)>u&&(a.zoomCumulativeDelta<0?(h>=p?r<=0?l=Math.min(s,l+1):r=Math.max(0,r-1):h<p&&(l>=s?r=Math.max(0,r-1):l=Math.min(s,l+1)),a.zoomCumulativeDelta=0):a.zoomCumulativeDelta>0&&(h>=p?r=r<l?r=Math.min(l,r+1):r:h<p&&(l=l>r?l=Math.max(r,l-1):l),a.zoomCumulativeDelta=0),e.options.ticks.min=d(n,i[r]),e.options.ticks.max=c(n,i[l]))},a.zoomFunctions.time=function(e,t,o,a){u(e,t,o,a);var n=e.options;n.time&&(n.time.min&&(n.time.min=n.ticks.min),n.time.max&&(n.time.max=n.ticks.max))},a.zoomFunctions.linear=u,a.zoomFunctions.logarithmic=u,a.panFunctions.category=function(e,t,o){var n,i=e.chart.data.labels,r=i.length-1,s=Math.max(e.ticks.length,1),l=o.speed,u=e.minIndex,p=Math.round(e.width/(s*l));a.panCumulativeDelta+=t,u=a.panCumulativeDelta>p?Math.max(0,u-1):a.panCumulativeDelta<-p?Math.min(r-s+1,u+1):u,a.panCumulativeDelta=u!==e.minIndex?0:a.panCumulativeDelta,n=Math.min(r,u+s-1),e.options.ticks.min=d(o,i[u]),e.options.ticks.max=c(o,i[n])},a.panFunctions.time=function(e,t,o){f(e,t,o);var a=e.options;a.time&&(a.time.min&&(a.time.min=a.ticks.min),a.time.max&&(a.time.max=a.ticks.max))},a.panFunctions.linear=f,a.panFunctions.logarithmic=f,a.panCumulativeDelta=0,a.zoomCumulativeDelta=0;var g={id:"zoom",afterInit:function(e){e.resetZoom=function(){s(e);var t=e.$zoom._originalOptions;o.each(e.scales,(function(e){var o=e.options.time,a=e.options.ticks;t[e.id]?(o&&(o.min=t[e.id].time.min,o.max=t[e.id].time.max),a&&(a.min=t[e.id].ticks.min,a.max=t[e.id].ticks.max)):(o&&(delete o.min,delete o.max),a&&(delete a.min,delete a.max))})),e.update()}},beforeUpdate:function(e,t){r(e,t)},beforeInit:function(e,n){e.$zoom={_originalOptions:{}};var i=e.$zoom._node=e.ctx.canvas;r(e,n);var c=e.$zoom._options,d=c.pan&&c.pan.threshold;e.$zoom._mouseDownHandler=function(t){i.addEventListener("mousemove",e.$zoom._mouseMoveHandler),e.$zoom._dragZoomStart=t},e.$zoom._mouseMoveHandler=function(t){e.$zoom._dragZoomStart&&(e.$zoom._dragZoomEnd=t,e.update(0))},e.$zoom._mouseUpHandler=function(t){if(e.$zoom._dragZoomStart){i.removeEventListener("mousemove",e.$zoom._mouseMoveHandler);var o=e.$zoom._dragZoomStart,a=o.target.getBoundingClientRect().left,n=Math.min(o.clientX,t.clientX)-a,r=Math.max(o.clientX,t.clientX)-a,s=o.target.getBoundingClientRect().top,d=Math.min(o.clientY,t.clientY)-s,u=r-n,p=Math.max(o.clientY,t.clientY)-s-d;e.$zoom._dragZoomStart=null,e.$zoom._dragZoomEnd=null;var f=c.zoom&&c.zoom.threshold||0;if(!(u<=f&&p<=f)){var m=e.chartArea,g=e.$zoom._options.zoom,v=m.right-m.left,b=l(g.mode,"x",e)&&u?1+(v-u)/v:1,$=m.bottom-m.top,w=l(g.mode,"y",e);h(e,b,w&&p?1+($-p)/$:1,{x:(n-m.left)/(1-u/v)+m.left,y:(d-m.top)/(1-p/$)+m.top},void 0,g.drag.animationDuration),"function"==typeof g.onZoomComplete&&g.onZoomComplete({chart:e})}}};var u=null;if(e.$zoom._wheelHandler=function(t){if(t.cancelable&&t.preventDefault(),void 0!==t.deltaY){var o=t.target.getBoundingClientRect(),a={x:t.clientX-o.left,y:t.clientY-o.top},n=e.$zoom._options.zoom,i=n.speed;t.deltaY>=0&&(i=-i),h(e,1+i,1+i,a),clearTimeout(u),u=setTimeout((function(){"function"==typeof n.onZoomComplete&&n.onZoomComplete({chart:e})}),250)}},t){var p,f=new t.Manager(i);f.add(new t.Pinch),f.add(new t.Pan({threshold:d}));var g=function(t){var o=1/p*t.scale,a=t.target.getBoundingClientRect(),n={x:t.center.x-a.left,y:t.center.y-a.top},i=Math.abs(t.pointers[0].clientX-t.pointers[1].clientX),r=Math.abs(t.pointers[0].clientY-t.pointers[1].clientY),s=i/r;h(e,o,o,n,s>.3&&s<1.7?"xy":i>r?"x":"y");var l=e.$zoom._options.zoom;"function"==typeof l.onZoomComplete&&l.onZoomComplete({chart:e}),p=t.scale};f.on("pinchstart",(function(){p=1})),f.on("pinch",g),f.on("pinchend",(function(e){g(e),p=null,a.zoomCumulativeDelta=0}));var v=null,b=null,$=!1,w=function(t){if(null!==v&&null!==b){$=!0;var a=t.deltaX-v,n=t.deltaY-b;v=t.deltaX,b=t.deltaY,function(e,t,a){s(e);var n=e.$zoom._options.pan;if(n.enabled){var i="function"==typeof n.mode?n.mode({chart:e}):n.mode;o.each(e.scales,(function(o){o.isHorizontal()&&l(i,"x",e)&&0!==t?(n.scaleAxes="x",m(o,t,n)):!o.isHorizontal()&&l(i,"y",e)&&0!==a&&(n.scaleAxes="y",m(o,a,n))})),e.update(0),"function"==typeof n.onPan&&n.onPan({chart:e})}}(e,a,n)}};f.on("panstart",(function(e){v=0,b=0,w(e)})),f.on("panmove",w),f.on("panend",(function(){v=null,b=null,a.panCumulativeDelta=0,setTimeout((function(){$=!1}),500);var t=e.$zoom._options.pan;"function"==typeof t.onPanComplete&&t.onPanComplete({chart:e})})),e.$zoom._ghostClickHandler=function(e){$&&e.cancelable&&(e.stopImmediatePropagation(),e.preventDefault())},i.addEventListener("click",e.$zoom._ghostClickHandler),e._mc=f}},beforeDatasetsDraw:function(e){var t=e.ctx;if(e.$zoom._dragZoomEnd){var o=function(e){for(var t=e.scales,o=Object.keys(t),a=0;a<o.length;a++){var n=t[o[a]];if(n.isHorizontal())return n}}(e),a=function(e){for(var t=e.scales,o=Object.keys(t),a=0;a<o.length;a++){var n=t[o[a]];if(!n.isHorizontal())return n}}(e),n=e.$zoom._dragZoomStart,i=e.$zoom._dragZoomEnd,r=o.left,s=o.right,c=a.top,d=a.bottom;if(l(e.$zoom._options.zoom.mode,"x",e)){var u=n.target.getBoundingClientRect().left;r=Math.min(n.clientX,i.clientX)-u,s=Math.max(n.clientX,i.clientX)-u}if(l(e.$zoom._options.zoom.mode,"y",e)){var p=n.target.getBoundingClientRect().top;c=Math.min(n.clientY,i.clientY)-p,d=Math.max(n.clientY,i.clientY)-p}var h=s-r,f=d-c,m=e.$zoom._options.zoom.drag;t.save(),t.beginPath(),t.fillStyle=m.backgroundColor||"rgba(225,225,225,0.3)",t.fillRect(r,c,h,f),m.borderWidth>0&&(t.lineWidth=m.borderWidth,t.strokeStyle=m.borderColor||"rgba(225,225,225)",t.strokeRect(r,c,h,f)),t.restore()}},destroy:function(e){if(e.$zoom){var t=e.$zoom,o=t._node;o.removeEventListener("mousedown",t._mouseDownHandler),o.removeEventListener("mousemove",t._mouseMoveHandler),o.ownerDocument.removeEventListener("mouseup",t._mouseUpHandler),o.removeEventListener("wheel",t._wheelHandler),o.removeEventListener("click",t._ghostClickHandler),delete e.$zoom;var a=e._mc;a&&(a.remove("pinchstart"),a.remove("pinch"),a.remove("pinchend"),a.remove("panstart"),a.remove("pan"),a.remove("panend"),a.destroy())}}};return e.plugins.register(g),g})),$(document).ready((function(){$("#wizard-modal .next.action-button").click((function(){if(animating)return!1;animating=!0,current_fs=$(this).parent(),next_fs=$(this).parent().next(),$("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active"),next_fs.show(),current_fs.animate({opacity:0},{step:function(e,t){scale=1-.2*(1-e),left=50*e+"%",opacity=1-e,current_fs.css({transform:"scale("+scale+")"}),next_fs.css({left:left,opacity:opacity})},duration:800,complete:function(){current_fs.hide(),animating=!1},easing:"easeInOutBack"})})),$("#wizard-modal .previous.action-button").click((function(){if(animating)return!1;animating=!0,current_fs=$(this).parent(),previous_fs=$(this).parent().prev(),$("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active"),previous_fs.show(),current_fs.animate({opacity:0},{step:function(e,t){scale=.8+.2*(1-e),left=50*(1-e)+"%",opacity=1-e,current_fs.css({left:left}),previous_fs.css({transform:"scale("+scale+")",opacity:opacity})},duration:800,complete:function(){current_fs.hide(),animating=!1},easing:"easeInOutBack"})})),$("#wizard-modal .cancel").click((function(){hideWizard(),resetWizard(),$("#wizard-disable").is(":checked")&&(localStorage.setItem("ShowWizard",never),localStorage.setItem("LastWizardDevice",$("#devname-label").text()))})),$("#wizard-modal .submit").click((function(){return hideWizard(),localStorage.setItem("ShowWizard",no),localStorage.setItem("LastWizardDevice",$("#wizard-device").val()),storeWizard(),resetWizard(),!1})),$("input:checkbox[name^=wizard-]").change((function(){var e=$(this).is(":checked")?yes:no;$(this).parent().parent().next().text(e),"wizard-is-marlin"==$(this).prop("name")&&e==yes&&($("#wizard-is-duet").prop("checked",""),$("#wizard-is-pmmu").prop("checked",""),$("#wizard-is-duet").parent().parent().next().text(no),$("#wizard-is-pmmu").parent().parent().next().text(no)),"wizard-is-pmmu"==$(this).prop("name")&&e==yes&&($("#wizard-is-duet").prop("checked",""),$("#wizard-is-marlin").prop("checked",""),$("#wizard-is-duet").parent().parent().next().text(no),$("#wizard-is-marlin").parent().parent().next().text(no)),"wizard-is-duet"==$(this).prop("name")&&e==yes&&($("#wizard-is-pmmu").prop("checked",""),$("#wizard-is-marlin").prop("checked",""),$("#wizard-is-marlin").parent().parent().next().text(no),$("#wizard-is-pmmu").parent().parent().next().text(no)),$("#wizard-is-pmmu").is(":checked")||$("#wizard-is-marlin").is(":checked")||$("#wizard-is-duet").is(":checked")||($("#wizard-is-marlin").prop("checked","checked"),$("#wizard-is-marlin").parent().parent().next().text(yes))}))}));